# 添加商家功能使用说明

## 功能概述
在商家数据中心页面添加了一个新功能，可以通过抖音主页分享链接快速添加商家数据。

## 使用步骤

### 1. 获取抖音主页分享链接
在抖音APP中，找到要添加的商家主页：
- 点击右上角的分享按钮
- 选择"复制链接"或"更多分享"
- 获得类似这样的链接：`https://v.douyin.com/xxx/`

也可以直接复制整个分享文案，系统会自动提取其中的链接。

### 2. 在商家中心页面添加商家
1. 访问 `/merchants` 页面
2. 点击右上角的"添加商家"按钮
3. 在对话框中粘贴分享链接或分享文案
4. （可选）选择商家分类
5. （可选）选择业务类型（默认 B2C）
6. （可选）设置同步视频数量（默认 100）
7. 点击"开始同步"按钮

### 3. 等待同步完成
系统会自动：
1. 解析分享链接，提取商家ID（约 20%）
2. 从 TikHub API 获取商家资料和视频数据（约 50-80%）
3. 保存到数据库并计算统计数据（约 100%）

同步完成后，对话框会显示成功信息，包括：
- 商家名称
- 新增视频数量
- 更新视频数量
- 总视频数量

3秒后对话框自动关闭，商家列表自动刷新。

## 技术实现

### 新增文件
1. **`components/merchants/add-merchant-dialog.tsx`**
   - 添加商家对话框组件
   - 处理表单输入、验证和提交
   - 显示同步进度和结果

2. **`app/api/douyin/parse-share/route.ts`**
   - 解析抖音分享链接的 API 端点
   - 提取 `sec_uid` 或 `userId`

### 修改文件
1. **`app/merchants/page.tsx`**
   - 在页面标题区域添加"添加商家"按钮
   - 传入商家分类数据
   - 同步成功后刷新列表

### 依赖的现有功能
- `lib/douyin/share-link.ts` - 解析抖音分享链接
- `app/api/tikhub/sync/route.ts` - 同步商家数据 API
- `lib/tikhub/sync-service.ts` - 同步服务逻辑
- `lib/tikhub/mapper.ts` - 数据映射函数

## 注意事项

1. **API 配额**：每次同步会消耗 TikHub API 配额，请注意余额
2. **同步时间**：根据视频数量，同步可能需要 30秒 - 2分钟
3. **重复添加**：如果商家已存在，会更新现有数据，不会重复创建
4. **错误处理**：如果链接格式错误或 API 失败，会显示具体错误信息

## 数据流程

```
用户输入分享链接
    ↓
POST /api/douyin/parse-share
    ↓
提取 sec_uid
    ↓
POST /api/tikhub/sync
    ↓
调用 TikHub API 获取资料和视频
    ↓
保存到数据库 (merchants + merchant_contents)
    ↓
计算聚合统计
    ↓
返回结果
```

## 后续优化建议

1. 支持批量导入（Excel/CSV 文件包含多个分享链接）
2. 添加定时自动更新功能
3. 显示更详细的同步日志
4. 支持手动输入 `sec_uid`（不依赖分享链接）
