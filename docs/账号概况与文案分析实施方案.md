# è´¦å·æ¦‚å†µä¸æ–‡æ¡ˆåˆ†æåŠŸèƒ½ - æŠ€æœ¯å®æ–½æ–¹æ¡ˆ

## ğŸ“‹ æ–¹æ¡ˆæ¦‚è¿°

### ä¸šåŠ¡ç›®æ ‡
ä¸ºç­¾çº¦å•†å®¶æä¾›ä¸¤å¤§æ ¸å¿ƒåŠŸèƒ½ï¼š
1. **è´¦å·æ¦‚å†µ**ï¼šè´¦å·æ€»è§ˆå¡ç‰‡ï¼Œå±•ç¤ºç²‰ä¸æ•°ã€å†…å®¹æ•°ã€äº’åŠ¨ç‡ã€æ–‡æ¡ˆè¦†ç›–ç‡ç­‰æ ¸å¿ƒæŒ‡æ ‡
2. **æ–‡æ¡ˆåˆ†æ**ï¼šåŸºäºè§†é¢‘è½¬å½•æ–‡æœ¬ï¼ˆtranscriptï¼‰çš„æ·±åº¦æ´å¯Ÿï¼ŒåŒ…æ‹¬å…³é”®è¯åˆ†æã€æƒ…ç»ªåˆ†æã€å¼€å¤´æ¨¡å¼è¯†åˆ«

### æ ¸å¿ƒç­–ç•¥
éµå¾ª Linus ä¸‰é—®åŸåˆ™ï¼š
- âœ… **å¤ç”¨ç°æœ‰æ¶æ„** - Merchant èšåˆå­—æ®µã€MerchantProfileã€Analytics API å…¨éƒ¨ä¿ç•™
- âœ… **æ‰“é€šæ–­ç‚¹** - è®© transcript èƒ½å¤Ÿæ‰¹é‡å…¥åº“å¹¶ä¸ AI æ¡£æ¡ˆè”åŠ¨
- âœ… **é¿å…é‡å¤é€»è¾‘** - ç›‘æ§é…ç½®ã€æ•°æ®ç»Ÿè®¡ã€AI æ¡£æ¡ˆå„å¸å…¶èŒ

### ç°çŠ¶åˆ†æ

#### æ•°æ®ç¼ºå£
1. **transcript å­—æ®µåœ¨åŒæ­¥é˜¶æ®µä¸ºç©º**ï¼ˆ`lib/tikhub/mapper.ts:105`ï¼‰
   ```typescript
   transcript: null,  // âŒ å†™æ­»ä¸ºç©º
   hasTranscript: false,  // âŒ å†™æ­»ä¸º false
   ```

2. **æ–‡æ¡ˆæå–é“¾æœªå…¥åº“**ï¼ˆ`app/api/douyin/extract-text/route.ts`ï¼‰
   ```
   è§†é¢‘é“¾æ¥ â†’ ä¸‹è½½è§†é¢‘ â†’ æå–éŸ³é¢‘ â†’ GPT-4oè½¬å½• â†’ âŒ åªè¿”å›å‰ç«¯ï¼Œæœªå…¥åº“
   ```

3. **è´¦å·æ¦‚å†µæ•°æ®åˆ†æ•£**
   - Merchant è¡¨æœ‰èšåˆå­—æ®µï¼ˆfollowerCountã€totalPlayCountã€avgEngagementRateï¼‰
   - ä½†ç¼ºå°‘ç»Ÿä¸€çš„"è´¦å·æ¦‚å†µ"UIç»„ä»¶
   - æ–‡æ¡ˆè¦†ç›–ç‡éœ€è¦å®æ—¶è®¡ç®—ï¼ˆ`hasTranscript=true` çš„æ¯”ä¾‹ï¼‰

#### ç°æœ‰èµ„äº§ç›˜ç‚¹

| èµ„äº§ | ä½ç½® | å¯å¤ç”¨ç¨‹åº¦ |
|------|------|-----------|
| èšåˆç»Ÿè®¡å­—æ®µ | `prisma/schema.prisma:170-213` Merchantè¡¨ | âœ… ç›´æ¥è¯»å– |
| AIæ¡£æ¡ˆç³»ç»Ÿ | `components/merchants/merchant-profile-card.tsx` | âœ… å¹³è¡Œæ‰©å±• |
| è½¬å½•æŠ€æœ¯æ ˆ | `app/api/douyin/extract-text/route.ts` | âœ… å¤ç”¨æ ¸å¿ƒé€»è¾‘ |
| Analyticsé¡µé¢ | `app/merchants/[id]/analytics/page.tsx` | âœ… æ–°å¢Tab |
| åŒæ­¥æœåŠ¡ | `lib/tikhub/sync-service.ts` | âš ï¸ éœ€ä¿®æ”¹mapperé€»è¾‘ |

---

## ğŸ—‚ï¸ å®æ–½é˜¶æ®µè§„åˆ’

```
ã€Phase 1ï¼šåŸºç¡€è®¾æ–½ã€‘æ‰“é€š transcript æ•°æ®æµï¼ˆä¼˜å…ˆçº§ï¼šP0ï¼‰
  â”œâ”€ 1.1 åˆ›å»ºæ‰¹é‡è½¬å½•å…¥åº“ API
  â”œâ”€ 1.2 ä¿®æ”¹ mapper.tsï¼Œæ”¯æŒå¢é‡æ›´æ–° transcript
  â””â”€ 1.3 æ·»åŠ è½¬å½•ä»»åŠ¡é˜Ÿåˆ—ï¼ˆå¯é€‰ï¼ŒP2ä¼˜å…ˆçº§ï¼‰

ã€Phase 2ï¼šè´¦å·æ¦‚å†µã€‘å±•ç¤ºè´¦å·æ€»è§ˆå¡ç‰‡ï¼ˆä¼˜å…ˆçº§ï¼šP0ï¼‰
  â”œâ”€ 2.1 åˆ›å»º AccountOverviewCard ç»„ä»¶
  â”œâ”€ 2.2 åœ¨è¯¦æƒ…é¡µé¡¶éƒ¨é›†æˆ
  â””â”€ 2.3 åœ¨ Analytics é¡µé¢æ–°å¢"æ¦‚å†µ"Tab

ã€Phase 3ï¼šæ–‡æ¡ˆåˆ†æã€‘åŸºäº transcript çš„æ´å¯Ÿï¼ˆä¼˜å…ˆçº§ï¼šP1ï¼‰
  â”œâ”€ 3.1 è®¾è®¡æ–‡æ¡ˆåˆ†æ APIï¼ˆå…³é”®è¯ã€æƒ…ç»ªã€å¼€å¤´æ¨¡å¼ï¼‰
  â”œâ”€ 3.2 åˆ›å»º CopywritingInsights ç»„ä»¶
  â””â”€ 3.3 è‡ªåŠ¨è§¦å‘ AI æ¡£æ¡ˆæ›´æ–°

ã€Phase 4ï¼šUI æ•´åˆã€‘ä¼˜åŒ–ç°æœ‰é¡µé¢ï¼ˆä¼˜å…ˆçº§ï¼šP1ï¼‰
  â”œâ”€ 4.1 è°ƒæ•´ Analytics é¡µé¢å¸ƒå±€
  â””â”€ 4.2 æ·»åŠ æ‰¹é‡è½¬å½•æ“ä½œå…¥å£
```

---

## ğŸ“ è¯¦ç»†æŠ€æœ¯è®¾è®¡

### Phase 1.1ï¼šæ‰¹é‡è½¬å½•å…¥åº“ API

#### API æ¥å£è®¾è®¡

**è·¯å¾„**ï¼š`app/api/merchants/[id]/contents/batch-transcribe/route.ts`

**è¯·æ±‚**ï¼š
```http
POST /api/merchants/{merchantId}/contents/batch-transcribe
Content-Type: application/json
Authorization: Bearer {session-token}

{
  "contentIds": ["cuid1", "cuid2", "cuid3"],  // è¦è½¬å½•çš„å†…å®¹IDåˆ—è¡¨
  "mode": "missing" | "all" | "force",        // missing=åªå¤„ç†ç©ºtranscript, all=å…¨éƒ¨, force=å¼ºåˆ¶è¦†ç›–
  "concurrent": 3                              // å¹¶å‘æ•°ï¼ˆé»˜è®¤3ï¼Œé¿å…APIé™æµï¼‰
}
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "summary": {
    "total": 10,
    "processed": 8,
    "skipped": 1,
    "failed": 1
  },
  "results": [
    {
      "contentId": "cuid1",
      "status": "success",
      "transcript": "å›å§åœ¨å—å®åšäº†15å¹´æ—§æˆ¿æ”¹é€ ...",
      "textLength": 180
    },
    {
      "contentId": "cuid2",
      "status": "skipped",
      "reason": "already_has_transcript"
    },
    {
      "contentId": "cuid3",
      "status": "failed",
      "error": "è§†é¢‘ä¸‹è½½å¤±è´¥: 403 Forbidden"
    }
  ]
}
```

#### æ ¸å¿ƒå®ç°é€»è¾‘

```typescript
// app/api/merchants/[id]/contents/batch-transcribe/route.ts

import { NextRequest } from 'next/server'
import { getServerSession } from 'next-auth'
import { authOptions } from '@/auth'
import prisma from '@/lib/prisma'
import { VideoProcessor } from '@/lib/video/video-processor'
import { getTikHubClient } from '@/lib/tikhub'
import { httpResponse } from '@/lib/api/http-response'

// é™åˆ¶å¹¶å‘æ•°ï¼Œé¿å…APIè¶…é™
async function processBatch<T>(
  items: T[],
  handler: (item: T) => Promise<any>,
  concurrent = 3
): Promise<PromiseSettledResult<any>[]> {
  const results: PromiseSettledResult<any>[] = []

  for (let i = 0; i < items.length; i += concurrent) {
    const batch = items.slice(i, i + concurrent)
    const batchResults = await Promise.allSettled(batch.map(handler))
    results.push(...batchResults)
  }

  return results
}

// è½¬å½•å•ä¸ªå†…å®¹
async function transcribeContent(contentId: string, apiKey: string) {
  // 1. è·å–å†…å®¹è¯¦æƒ…
  const content = await prisma.merchantContent.findUnique({
    where: { id: contentId },
    select: { externalId: true, transcript: true }
  })

  if (!content) throw new Error('å†…å®¹ä¸å­˜åœ¨')

  // 2. è·å–è§†é¢‘è¯¦æƒ…
  const tikhubClient = getTikHubClient()
  const videoDetail = await tikhubClient.getVideoDetail({
    aweme_id: content.externalId
  })

  const videoUrl = resolvePlayableVideoUrl(videoDetail.aweme_detail)
  if (!videoUrl) throw new Error('æ— æ³•è·å–è§†é¢‘æ’­æ”¾åœ°å€')

  // 3. ä¸‹è½½è§†é¢‘
  const videoBuffer = await VideoProcessor.downloadVideo(videoUrl, ...)

  // 4. æå–éŸ³é¢‘
  const audioBuffer = await VideoProcessor.extractAudio(videoBuffer, {
    format: 'mp3',
    sampleRate: 16000,
    channels: 1,
    bitrate: '128k'
  })

  // 5. GPT-4o Audio Preview è½¬å½•
  const base64Audio = audioBuffer.toString('base64')
  const asrResponse = await fetch('https://api.302.ai/v1/chat/completions', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      Authorization: `Bearer ${apiKey}`
    },
    body: JSON.stringify({
      model: 'gpt-4o-audio-preview',
      modalities: ['text'],
      messages: [
        {
          role: 'user',
          content: [
            { type: 'text', text: 'è¯·è½¬å½•ä»¥ä¸‹éŸ³é¢‘å†…å®¹...' },
            { type: 'input_audio', input_audio: { data: base64Audio, format: 'mp3' } }
          ]
        }
      ]
    })
  })

  const asrResult = await asrResponse.json()
  const transcript = asrResult.choices?.[0]?.message?.content || ''

  // 6. ä¼˜åŒ–æ–‡æ¡ˆï¼ˆä½¿ç”¨Claudeï¼‰
  const optimizedText = await optimizeTextWithLLM(transcript, apiKey, {
    title: videoDetail.aweme_detail.desc,
    author: videoDetail.aweme_detail.author?.nickname,
    hashtags: videoDetail.aweme_detail.text_extra?.map(t => t.hashtag_name)
  })

  // 7. æ›´æ–°æ•°æ®åº“
  await prisma.merchantContent.update({
    where: { id: contentId },
    data: {
      transcript: optimizedText || transcript,
      hasTranscript: true
    }
  })

  return { transcript: optimizedText || transcript, textLength: transcript.length }
}

export async function POST(req: NextRequest, { params }: { params: { id: string } }) {
  const session = await getServerSession(authOptions)
  if (!session || session.user.role !== 'ADMIN') {
    return httpResponse.unauthorized('éœ€è¦ç®¡ç†å‘˜æƒé™')
  }

  const { contentIds, mode = 'missing', concurrent = 3 } = await req.json()
  const merchantId = params.id

  // éªŒè¯å•†å®¶å­˜åœ¨
  const merchant = await prisma.merchant.findUnique({ where: { id: merchantId } })
  if (!merchant) return httpResponse.notFound('å•†å®¶ä¸å­˜åœ¨')

  // è·å–API Key
  const apiKey = process.env.DOUBAO_ASR_API_KEY || process.env.LLM_API_KEY
  if (!apiKey) return httpResponse.error('æœªé…ç½®API Key')

  // æ ¹æ®modeè¿‡æ»¤å†…å®¹
  let targetContents = await prisma.merchantContent.findMany({
    where: {
      id: { in: contentIds },
      merchantId
    },
    select: { id: true, transcript: true }
  })

  if (mode === 'missing') {
    targetContents = targetContents.filter(c => !c.transcript)
  }

  // æ‰¹é‡å¤„ç†
  const results = await processBatch(
    targetContents,
    async (content) => {
      const result = await transcribeContent(content.id, apiKey)
      return { contentId: content.id, status: 'success', ...result }
    },
    concurrent
  )

  // ç»Ÿè®¡ç»“æœ
  const summary = {
    total: contentIds.length,
    processed: results.filter(r => r.status === 'fulfilled').length,
    skipped: contentIds.length - targetContents.length,
    failed: results.filter(r => r.status === 'rejected').length
  }

  const detailedResults = results.map((r, i) => {
    if (r.status === 'fulfilled') {
      return r.value
    } else {
      return {
        contentId: targetContents[i].id,
        status: 'failed',
        error: r.reason?.message || 'æœªçŸ¥é”™è¯¯'
      }
    }
  })

  return httpResponse.success({
    summary,
    results: detailedResults
  })
}
```

#### é”™è¯¯å¤„ç†ç­–ç•¥

| é”™è¯¯ç±»å‹ | å¤„ç†æ–¹å¼ | ç”¨æˆ·æç¤º |
|---------|---------|---------|
| è§†é¢‘ä¸‹è½½å¤±è´¥ | è·³è¿‡æ­¤æ¡ï¼Œç»§ç»­å¤„ç†å…¶ä»– | "è§†é¢‘ä¸å¯è®¿é—®ï¼Œå·²è·³è¿‡" |
| éŸ³é¢‘æå–å¤±è´¥ | è·³è¿‡æ­¤æ¡ | "éŸ³é¢‘æå–å¤±è´¥" |
| è½¬å½•APIè¶…é™ | æš‚åœ30ç§’åé‡è¯•1æ¬¡ | "APIé™æµï¼Œè‡ªåŠ¨é‡è¯•ä¸­" |
| è½¬å½•å¤±è´¥ | è®°å½•é”™è¯¯ï¼Œç»§ç»­ä¸‹ä¸€æ¡ | "è½¬å½•å¤±è´¥: {error}" |
| æ•°æ®åº“å†™å…¥å¤±è´¥ | å›æ»šæ­¤æ¡äº‹åŠ¡ | "ä¿å­˜å¤±è´¥" |

---

### Phase 1.2ï¼šä¿®æ”¹ mapper.tsï¼Œæ”¯æŒå¢é‡æ›´æ–°

#### é—®é¢˜åˆ†æ

**å½“å‰ä»£ç **ï¼ˆ`lib/tikhub/mapper.ts:105`ï¼‰ï¼š
```typescript
export function mapVideoToMerchantContent(video: DouyinVideo, merchantId: string) {
  return {
    // ... å…¶ä»–å­—æ®µ
    transcript: null,  // âŒ å†™æ­»ä¸ºç©ºï¼Œå¯¼è‡´æ¯æ¬¡åŒæ­¥éƒ½è¦†ç›–å·²æœ‰çš„transcript
    hasTranscript: false,
  }
}
```

**é—®é¢˜**ï¼š
- æ¯æ¬¡è°ƒç”¨ `syncMerchantData` åŒæ­¥æœ€æ–°è§†é¢‘æ•°æ®æ—¶ï¼Œä¼šè¦†ç›–å·²æœ‰çš„ `transcript`
- ç”¨æˆ·æ‰‹åŠ¨è½¬å½•çš„æ–‡æ¡ˆä¼šä¸¢å¤±

#### è§£å†³æ–¹æ¡ˆ

**ä¿®æ”¹å‡½æ•°ç­¾åï¼Œæ·»åŠ å¯é€‰å‚æ•°**ï¼š

```typescript
// lib/tikhub/mapper.ts

export function mapVideoToMerchantContent(
  video: DouyinVideo,
  merchantId: string,
  options?: {
    preserveTranscript?: boolean  // âœ… æ–°å¢ï¼šæ˜¯å¦ä¿ç•™ç°æœ‰transcript
  }
): Omit<MerchantContent, 'id' | 'createdAt' | 'updatedAt'> {
  return {
    merchantId,
    externalId: video.aweme_id,
    title: video.desc || 'æ— æ ‡é¢˜',
    content: video.desc || null,

    // âœ… æ ¹æ®optionså†³å®šæ˜¯å¦è®¾ç½®transcript
    ...(options?.preserveTranscript
      ? {}  // ä¸è®¾ç½®transcriptå’ŒhasTranscriptï¼ŒPrismaä¼šè·³è¿‡è¿™ä¸¤ä¸ªå­—æ®µ
      : { transcript: null, hasTranscript: false }
    ),

    contentType: determineContentType(video),
    diggCount: video.statistics?.digg_count || 0,
    // ... å…¶ä»–å­—æ®µ
  }
}
```

#### è°ƒç”¨æ–¹ä¿®æ”¹

**æ–‡ä»¶**ï¼š`lib/tikhub/sync-service.ts`

**å½“å‰è°ƒç”¨**ï¼š
```typescript
const contentData = mapVideoToMerchantContent(video, merchant.id)
```

**ä¿®æ”¹ä¸º**ï¼š
```typescript
const contentData = mapVideoToMerchantContent(video, merchant.id, {
  preserveTranscript: true  // âœ… ä¿ç•™å·²æœ‰çš„transcript
})
```

#### Prisma Upsert é€»è¾‘

```typescript
// lib/tikhub/sync-service.ts

await prisma.merchantContent.upsert({
  where: {
    externalId_merchantId: {
      externalId: video.aweme_id,
      merchantId: merchant.id
    }
  },
  update: {
    // âœ… transcript å’Œ hasTranscript ä¸ä¼šè¢«åŒ…å«åœ¨ contentData ä¸­
    // Prisma ä¼šè‡ªåŠ¨è·³è¿‡è¿™ä¸¤ä¸ªå­—æ®µï¼Œä¿ç•™æ•°æ®åº“ä¸­çš„ç°æœ‰å€¼
    title: contentData.title,
    content: contentData.content,
    diggCount: contentData.diggCount,
    commentCount: contentData.commentCount,
    // ... å…¶ä»–éœ€è¦æ›´æ–°çš„å­—æ®µ
  },
  create: contentData  // æ–°å»ºæ—¶ transcript ä¸ºç©ºï¼ˆç¬¦åˆé¢„æœŸï¼‰
})
```

#### æµ‹è¯•åœºæ™¯

| åœºæ™¯ | æ“ä½œ | é¢„æœŸç»“æœ |
|------|------|---------|
| æ–°è§†é¢‘åŒæ­¥ | é¦–æ¬¡è°ƒç”¨ syncMerchantData | transcript=null, hasTranscript=false |
| å·²è½¬å½•è§†é¢‘å†åŒæ­¥ | æ›´æ–°äº’åŠ¨æ•°æ® | transcriptä¿æŒåŸå€¼ï¼Œäº’åŠ¨æ•°æ®æ›´æ–° |
| æ‰¹é‡è½¬å½•ååŒæ­¥ | åŒæ­¥æœ€æ–°è§†é¢‘ | å·²è½¬å½•çš„ä¿ç•™ï¼Œæ–°è§†é¢‘ä¸ºç©º |

---

### Phase 2.1ï¼šAccountOverviewCard ç»„ä»¶

#### ç»„ä»¶è®¾è®¡

**æ–‡ä»¶ä½ç½®**ï¼š`components/merchants/account-overview-card.tsx`

**Props æ¥å£**ï¼š
```typescript
interface AccountOverviewCardProps {
  merchant: MerchantWithDetails
  showActions?: boolean  // æ˜¯å¦æ˜¾ç¤ºæ“ä½œæŒ‰é’®ï¼ˆå¦‚"æ‰¹é‡è½¬å½•"ï¼‰
}
```

**æ•°æ®è®¡ç®—é€»è¾‘**ï¼š
```typescript
import { useMemo } from 'react'
import type { MerchantWithDetails } from '@/types/merchant'

export function AccountOverviewCard({ merchant, showActions = false }: AccountOverviewCardProps) {
  // è®¡ç®—è½¬å½•è¦†ç›–ç‡
  const transcriptCoverage = useMemo(() => {
    if (!merchant.contents || merchant.totalContentCount === 0) return 0
    const withTranscript = merchant.contents.filter(c => c.hasTranscript).length
    return Math.round((withTranscript / merchant.totalContentCount) * 100)
  }, [merchant])

  // è®¡ç®—å¹³å‡äº’åŠ¨ç‡ï¼ˆå¦‚æœæ•°æ®åº“å­—æ®µä¸ºç©ºï¼Œåˆ™å®æ—¶è®¡ç®—ï¼‰
  const avgEngagement = useMemo(() => {
    if (merchant.avgEngagementRate !== null) {
      return merchant.avgEngagementRate
    }
    if (merchant.totalContentCount === 0) return 0
    return merchant.totalEngagement / merchant.totalContentCount
  }, [merchant])

  // ç›‘æ§çŠ¶æ€æ–‡æœ¬
  const monitoringStatus = useMemo(() => {
    if (!merchant.monitoringEnabled) return 'æœªå¯ç”¨'
    const intervalHours = merchant.syncIntervalSeconds / 3600
    return `å·²å¯ç”¨ï¼ˆ${intervalHours}å°æ—¶/æ¬¡ï¼‰`
  }, [merchant])

  // æœ€ååŒæ­¥æ—¶é—´æ–‡æœ¬
  const lastSyncText = useMemo(() => {
    if (!merchant.lastCollectedAt) return 'ä»æœªåŒæ­¥'
    const lastSync = new Date(merchant.lastCollectedAt)
    const now = new Date()
    const diffMs = now.getTime() - lastSync.getTime()
    const diffHours = Math.floor(diffMs / (1000 * 60 * 60))

    if (diffHours < 1) return '1å°æ—¶å†…'
    if (diffHours < 24) return `${diffHours}å°æ—¶å‰`
    const diffDays = Math.floor(diffHours / 24)
    return `${diffDays}å¤©å‰`
  }, [merchant])

  return (
    <Card>
      <CardHeader>
        <div className="flex items-center justify-between">
          <CardTitle className="flex items-center gap-2">
            <Users className="h-5 w-5" />
            è´¦å·æ¦‚å†µ
          </CardTitle>
          {showActions && (
            <Button variant="outline" size="sm" asChild>
              <a href={`/merchants/${merchant.id}/batch-transcribe`}>
                æ‰¹é‡è½¬å½•
              </a>
            </Button>
          )}
        </div>
      </CardHeader>
      <CardContent>
        <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
          {/* ç²‰ä¸æ•° */}
          <MetricCard
            icon={<Users className="h-4 w-4 text-blue-500" />}
            label="ç²‰ä¸æ•°"
            value={formatNumber(merchant.followerCount)}
            verified={merchant.isVerified}
          />

          {/* å†…å®¹æ•° */}
          <MetricCard
            icon={<FileVideo className="h-4 w-4 text-purple-500" />}
            label="å†…å®¹æ•°"
            value={merchant.totalContentCount}
          />

          {/* æ€»äº’åŠ¨ */}
          <MetricCard
            icon={<Heart className="h-4 w-4 text-red-500" />}
            label="æ€»äº’åŠ¨"
            value={formatNumber(merchant.totalEngagement)}
          />

          {/* æ–‡æ¡ˆè¦†ç›–ç‡ */}
          <MetricCard
            icon={<FileText className="h-4 w-4 text-green-500" />}
            label="æ–‡æ¡ˆè¦†ç›–ç‡"
            value={`${transcriptCoverage}%`}
            progress={transcriptCoverage}
          />

          {/* ç›‘æ§çŠ¶æ€ */}
          <MetricCard
            icon={<RefreshCw className="h-4 w-4 text-orange-500" />}
            label="ç›‘æ§çŠ¶æ€"
            value={monitoringStatus}
          />

          {/* æœ€ååŒæ­¥ */}
          <MetricCard
            icon={<Clock className="h-4 w-4 text-gray-500" />}
            label="æœ€ååŒæ­¥"
            value={lastSyncText}
          />
        </div>
      </CardContent>
    </Card>
  )
}

// æŒ‡æ ‡å¡ç‰‡å­ç»„ä»¶
function MetricCard({
  icon,
  label,
  value,
  verified,
  progress
}: {
  icon: React.ReactNode
  label: string
  value: string | number
  verified?: boolean
  progress?: number
}) {
  return (
    <div className="space-y-1">
      <div className="flex items-center gap-1 text-sm text-muted-foreground">
        {icon}
        <span>{label}</span>
        {verified && <CheckCircle2 className="h-3 w-3 text-blue-500 ml-1" />}
      </div>
      <div className="text-2xl font-bold">{value}</div>
      {progress !== undefined && (
        <Progress value={progress} className="h-1" />
      )}
    </div>
  )
}

// æ ¼å¼åŒ–æ•°å­—ï¼ˆå¤ç”¨ç°æœ‰é€»è¾‘ï¼‰
function formatNumber(num: number | bigint): string {
  const n = typeof num === 'bigint' ? Number(num) : num
  if (n >= 10000) {
    return `${(n / 10000).toFixed(1)}ä¸‡`
  }
  return n.toLocaleString()
}
```

#### UI æ•ˆæœé¢„è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‘¥ è´¦å·æ¦‚å†µ                           [æ‰¹é‡è½¬å½•]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ‘¥ ç²‰ä¸æ•° âœ“     ğŸ“¹ å†…å®¹æ•°      â¤ï¸ æ€»äº’åŠ¨             â”‚
â”‚  12.5ä¸‡           328            45.2ä¸‡                â”‚
â”‚                                                        â”‚
â”‚  ğŸ“ æ–‡æ¡ˆè¦†ç›–ç‡   ğŸ”„ ç›‘æ§çŠ¶æ€     ğŸ• æœ€ååŒæ­¥           â”‚
â”‚  78%             å·²å¯ç”¨(6h/æ¬¡)    2å°æ—¶å‰              â”‚
â”‚  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘]                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Phase 2.2ï¼šé›†æˆåˆ°è¯¦æƒ…é¡µ

#### é›†æˆä½ç½®

**æ–‡ä»¶**ï¼š`app/merchants/[id]/page.tsx`

**æ’å…¥ä½ç½®**ï¼šç¬¬ 336 è¡Œä¹‹åï¼ˆMerchantProfileCard ä¹‹åï¼‰

```tsx
{/* å•†å®¶åˆ›ä½œæ¡£æ¡ˆ */}
<MerchantProfileCard
  merchantId={merchant.id}
  merchantName={merchant.name}
  totalContentCount={merchant.totalContentCount}
  isAdmin={session?.user?.role === 'ADMIN'}
/>

{/* âœ… æ–°å¢ï¼šè´¦å·æ¦‚å†µå¡ç‰‡ */}
<AccountOverviewCard
  merchant={merchant}
  showActions={session?.user?.role === 'ADMIN'}
/>

<div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
  {/* åŸæœ‰çš„åŸºæœ¬ä¿¡æ¯ã€å†…å®¹åˆ—è¡¨ç­‰ */}
</div>
```

#### å“åº”å¼å¸ƒå±€

- **æ¡Œé¢ç«¯**ï¼š6åˆ—ç½‘æ ¼å¸ƒå±€ï¼Œæ¯ä¸ªæŒ‡æ ‡å 1åˆ—
- **å¹³æ¿ç«¯**ï¼š3åˆ—ç½‘æ ¼å¸ƒå±€
- **ç§»åŠ¨ç«¯**ï¼š2åˆ—ç½‘æ ¼å¸ƒå±€

---

### Phase 2.3ï¼šåœ¨ Analytics é¡µé¢æ–°å¢"æ¦‚å†µ"Tab

#### é¡µé¢è°ƒæ•´

**æ–‡ä»¶**ï¼š`app/merchants/[id]/analytics/page.tsx`

**ä¿®æ”¹ Tabs ç»“æ„**ï¼š

```tsx
<Tabs defaultValue="overview" className="w-full">
  <TabsList className="grid w-full grid-cols-4">
    <TabsTrigger value="overview">è´¦å·æ¦‚å†µ</TabsTrigger>  {/* âœ… æ–°å¢ */}
    <TabsTrigger value="engagement">äº’åŠ¨åˆ†æ</TabsTrigger>
    <TabsTrigger value="content">å†…å®¹åˆ†æ</TabsTrigger>
    <TabsTrigger value="tags">æ ‡ç­¾åˆ†æ</TabsTrigger>
  </TabsList>

  {/* âœ… æ–°å¢ Tab å†…å®¹ */}
  <TabsContent value="overview" className="space-y-6">
    <AccountOverviewCard merchant={merchant} showActions={false} />

    {/* å¯é€‰ï¼šæ·»åŠ æ ¸å¿ƒæŒ‡æ ‡è¶‹åŠ¿å›¾ */}
    <Card>
      <CardHeader>
        <CardTitle>æ•°æ®è¶‹åŠ¿</CardTitle>
      </CardHeader>
      <CardContent>
        {/* TODO: ç²‰ä¸å¢é•¿è¶‹åŠ¿ã€äº’åŠ¨ç‡è¶‹åŠ¿ç­‰å›¾è¡¨ */}
      </CardContent>
    </Card>
  </TabsContent>

  {/* ä¿ç•™åŸæœ‰çš„ engagement/content/tags Tab */}
  <TabsContent value="engagement">...</TabsContent>
  <TabsContent value="content">...</TabsContent>
  <TabsContent value="tags">...</TabsContent>
</Tabs>
```

---

### Phase 3.1ï¼šæ–‡æ¡ˆåˆ†æ API

#### API æ¥å£è®¾è®¡

**è·¯å¾„**ï¼š`app/api/merchants/[id]/copywriting-insights/route.ts`

**è¯·æ±‚**ï¼š
```http
GET /api/merchants/{merchantId}/copywriting-insights?regenerate=false
Authorization: Bearer {session-token}
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "data": {
    "summary": {
      "totalTranscripts": 185,
      "totalWords": 33240,
      "avgWordsPerContent": 180,
      "coverageRate": 0.78
    },
    "keywordCloud": [
      { "keyword": "æ—§æˆ¿æ”¹é€ ", "count": 25, "avgEngagement": 1850 },
      { "keyword": "å—å®", "count": 18, "avgEngagement": 1620 },
      { "keyword": "è£…ä¿®", "count": 15, "avgEngagement": 1420 }
    ],
    "emotionalTone": {
      "positive": 0.65,
      "neutral": 0.25,
      "negative": 0.10
    },
    "openingPatterns": [
      {
        "pattern": "é—®é¢˜å¼•å…¥",
        "count": 12,
        "examples": ["ä½ çŸ¥é“å—ï¼Ÿ", "æœ‰å¤šå°‘äººçŸ¥é“"],
        "avgEngagement": 2100
      },
      {
        "pattern": "åœºæ™¯æè¿°",
        "count": 8,
        "examples": ["ä»Šå¤©æ¥åˆ°...", "è¿™æ˜¯ä¸€ä¸ª..."],
        "avgEngagement": 1800
      }
    ],
    "topPerformingKeywords": ["æ”¹é€ ", "è£…ä¿®", "è®¾è®¡", "è€æˆ¿", "ç¿»æ–°"],
    "generatedAt": "2025-01-07T10:30:00Z",
    "cacheValid": true
  }
}
```

#### æ ¸å¿ƒå®ç°é€»è¾‘

```typescript
// app/api/merchants/[id]/copywriting-insights/route.ts

import { NextRequest } from 'next/server'
import { getServerSession } from 'next-auth'
import prisma from '@/lib/prisma'
import { httpResponse } from '@/lib/api/http-response'

// ä½¿ç”¨ AI åˆ†ææ–‡æ¡ˆ
async function analyzeTranscripts(transcripts: string[], apiKey: string) {
  // åˆå¹¶æ‰€æœ‰è½¬å½•æ–‡æœ¬ï¼ˆé™åˆ¶æ€»é•¿åº¦ï¼Œé¿å…è¶…Tokenï¼‰
  const combinedText = transcripts.slice(0, 50).join('\n---\n')

  const response = await fetch('https://api.302.ai/v1/chat/completions', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      Authorization: `Bearer ${apiKey}`
    },
    body: JSON.stringify({
      model: 'claude-sonnet-4-5-20250929',
      messages: [
        {
          role: 'system',
          content: `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æŠ–éŸ³æ–‡æ¡ˆåˆ†æå¸ˆã€‚è¯·åˆ†æä»¥ä¸‹è§†é¢‘è½¬å½•æ–‡æœ¬ï¼Œæå–ï¼š
1. é«˜é¢‘å…³é”®è¯ï¼ˆTOP 20ï¼ŒåŒ…å«å‡ºç°æ¬¡æ•°ï¼‰
2. æƒ…ç»ªåˆ†æï¼ˆæ­£é¢/ä¸­æ€§/è´Ÿé¢å æ¯”ï¼‰
3. å¼€å¤´æ¨¡å¼ï¼ˆå½’ç±»å‰3ç§å¸¸è§å¼€å¤´æ–¹å¼ï¼Œç»™å‡ºç¤ºä¾‹ï¼‰

è¯·ä»¥ JSON æ ¼å¼è¿”å›ï¼š
{
  "keywords": [{"word": "æ—§æˆ¿æ”¹é€ ", "count": 25}, ...],
  "emotion": {"positive": 0.65, "neutral": 0.25, "negative": 0.10},
  "openings": [{"pattern": "é—®é¢˜å¼•å…¥", "examples": ["ä½ çŸ¥é“å—ï¼Ÿ"], "count": 12}, ...]
}`
        },
        {
          role: 'user',
          content: combinedText
        }
      ],
      temperature: 0.3
    })
  })

  const result = await response.json()
  const analysisText = result.choices?.[0]?.message?.content || '{}'

  // å°è¯•è§£æJSONï¼ˆå¦‚æœAIè¿”å›äº†åŒ…è£¹çš„markdownï¼Œéœ€è¦æ¸…æ´—ï¼‰
  const jsonMatch = analysisText.match(/\{[\s\S]*\}/)
  return jsonMatch ? JSON.parse(jsonMatch[0]) : {}
}

export async function GET(req: NextRequest, { params }: { params: { id: string } }) {
  const session = await getServerSession(authOptions)
  if (!session) return httpResponse.unauthorized()

  const merchantId = params.id
  const regenerate = req.nextUrl.searchParams.get('regenerate') === 'true'

  // 1. æ£€æŸ¥æ˜¯å¦æœ‰ç¼“å­˜ï¼ˆå­˜å‚¨åœ¨ MerchantProfile.customBackgroundï¼‰
  const profile = await prisma.merchantProfile.findUnique({
    where: { merchantId },
    select: { customBackground: true, updatedAt: true }
  })

  // å¦‚æœæœ‰ç¼“å­˜ä¸”æœªè¿‡æœŸï¼ˆ24å°æ—¶ï¼‰ï¼Œç›´æ¥è¿”å›
  if (!regenerate && profile?.customBackground) {
    try {
      const cached = JSON.parse(profile.customBackground)
      const cacheAge = Date.now() - new Date(profile.updatedAt).getTime()
      if (cacheAge < 24 * 60 * 60 * 1000) {  // 24å°æ—¶ç¼“å­˜
        return httpResponse.success({ ...cached, cacheValid: true })
      }
    } catch (e) {
      // ç¼“å­˜è§£æå¤±è´¥ï¼Œç»§ç»­ç”Ÿæˆæ–°çš„
    }
  }

  // 2. è·å–æ‰€æœ‰å·²è½¬å½•å†…å®¹
  const contents = await prisma.merchantContent.findMany({
    where: {
      merchantId,
      hasTranscript: true,
      transcript: { not: null }
    },
    select: {
      transcript: true,
      diggCount: true,
      commentCount: true,
      collectCount: true,
      shareCount: true
    },
    orderBy: { publishedAt: 'desc' }
  })

  if (contents.length === 0) {
    return httpResponse.success({
      summary: { totalTranscripts: 0, coverageRate: 0 },
      message: 'æš‚æ— è½¬å½•æ•°æ®'
    })
  }

  // 3. è°ƒç”¨ AI åˆ†æ
  const apiKey = process.env.LLM_CLAUDE_API_KEY || process.env.LLM_API_KEY
  if (!apiKey) return httpResponse.error('æœªé…ç½®AI API Key')

  const transcripts = contents.map(c => c.transcript!).filter(Boolean)
  const aiAnalysis = await analyzeTranscripts(transcripts, apiKey)

  // 4. è®¡ç®—äº’åŠ¨æ•°æ®å…³è”
  const keywordEngagement = new Map<string, { sum: number; count: number }>()

  aiAnalysis.keywords?.forEach((kw: any) => {
    const relatedContents = contents.filter(c =>
      c.transcript?.includes(kw.word)
    )
    const totalEngagement = relatedContents.reduce((sum, c) =>
      sum + c.diggCount + c.commentCount + c.collectCount + c.shareCount, 0
    )
    keywordEngagement.set(kw.word, {
      sum: totalEngagement,
      count: relatedContents.length
    })
  })

  const keywordCloud = aiAnalysis.keywords?.map((kw: any) => {
    const stats = keywordEngagement.get(kw.word)
    return {
      keyword: kw.word,
      count: kw.count,
      avgEngagement: stats ? Math.round(stats.sum / stats.count) : 0
    }
  }).sort((a: any, b: any) => b.avgEngagement - a.avgEngagement) || []

  // 5. æ„å»ºå“åº”æ•°æ®
  const result = {
    summary: {
      totalTranscripts: contents.length,
      totalWords: transcripts.reduce((sum, t) => sum + t.length, 0),
      avgWordsPerContent: Math.round(transcripts.reduce((sum, t) => sum + t.length, 0) / transcripts.length),
      coverageRate: contents.length / (await prisma.merchantContent.count({ where: { merchantId } }))
    },
    keywordCloud: keywordCloud.slice(0, 20),
    emotionalTone: aiAnalysis.emotion || { positive: 0, neutral: 0, negative: 0 },
    openingPatterns: aiAnalysis.openings || [],
    topPerformingKeywords: keywordCloud.slice(0, 5).map((k: any) => k.keyword),
    generatedAt: new Date().toISOString(),
    cacheValid: false
  }

  // 6. ç¼“å­˜ç»“æœï¼ˆå­˜å‚¨åˆ° MerchantProfileï¼‰
  await prisma.merchantProfile.upsert({
    where: { merchantId },
    update: { customBackground: JSON.stringify(result) },
    create: { merchantId, customBackground: JSON.stringify(result) }
  })

  return httpResponse.success(result)
}
```

#### ç¼“å­˜ç­–ç•¥

| åœºæ™¯ | ç­–ç•¥ | ç¼“å­˜ä½ç½® |
|------|------|---------|
| é¦–æ¬¡è®¿é—® | ç”Ÿæˆæ–°æ•°æ® | MerchantProfile.customBackground |
| 24å°æ—¶å†…å†è®¿é—® | è¿”å›ç¼“å­˜ | ç›´æ¥ä»æ•°æ®åº“è¯»å– |
| æ‰‹åŠ¨åˆ·æ–° | å¼ºåˆ¶é‡æ–°ç”Ÿæˆ | è¦†ç›–ç¼“å­˜ |
| æ‰¹é‡è½¬å½•å®Œæˆå | è‡ªåŠ¨æ¸…é™¤ç¼“å­˜ | è§¦å‘é‡æ–°ç”Ÿæˆ |

---

### Phase 3.2ï¼šCopywritingInsights ç»„ä»¶

#### ç»„ä»¶è®¾è®¡

**æ–‡ä»¶ä½ç½®**ï¼š`components/merchants/copywriting-insights.tsx`

**Props æ¥å£**ï¼š
```typescript
interface CopywritingInsightsProps {
  merchantId: string
  autoRefresh?: boolean  // æ˜¯å¦è‡ªåŠ¨åˆ·æ–°ï¼ˆé»˜è®¤falseï¼‰
}
```

**å®Œæ•´ä»£ç **ï¼š

```tsx
'use client'

import { useState, useEffect } from 'react'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import { Button } from '@/components/ui/button'
import { Progress } from '@/components/ui/progress'
import { Skeleton } from '@/components/ui/skeleton'
import { RefreshCw, FileText, Smile, Meh, Frown, TrendingUp } from 'lucide-react'
import { unwrapApiResponse } from '@/lib/api/http-response'

interface InsightsData {
  summary: {
    totalTranscripts: number
    totalWords: number
    avgWordsPerContent: number
    coverageRate: number
  }
  keywordCloud: Array<{
    keyword: string
    count: number
    avgEngagement: number
  }>
  emotionalTone: {
    positive: number
    neutral: number
    negative: number
  }
  openingPatterns: Array<{
    pattern: string
    count: number
    examples: string[]
    avgEngagement: number
  }>
  topPerformingKeywords: string[]
}

export function CopywritingInsights({ merchantId, autoRefresh = false }: CopywritingInsightsProps) {
  const [data, setData] = useState<InsightsData | null>(null)
  const [loading, setLoading] = useState(true)
  const [refreshing, setRefreshing] = useState(false)

  const fetchInsights = async (regenerate = false) => {
    try {
      regenerate && setRefreshing(true)
      !regenerate && setLoading(true)

      const response = await fetch(
        `/api/merchants/${merchantId}/copywriting-insights?regenerate=${regenerate}`
      )
      const result = await response.json()
      const insights = unwrapApiResponse<InsightsData>(result)
      setData(insights)
    } catch (error) {
      console.error('è·å–æ–‡æ¡ˆåˆ†æå¤±è´¥', error)
    } finally {
      setLoading(false)
      setRefreshing(false)
    }
  }

  useEffect(() => {
    fetchInsights()
  }, [merchantId])

  if (loading) {
    return (
      <div className="space-y-6">
        <Skeleton className="h-48" />
        <Skeleton className="h-64" />
      </div>
    )
  }

  if (!data || data.summary.totalTranscripts === 0) {
    return (
      <Card>
        <CardContent className="py-12 text-center text-muted-foreground">
          <FileText className="h-12 w-12 mx-auto mb-4 opacity-50" />
          <p>æš‚æ— è½¬å½•æ•°æ®ï¼Œè¯·å…ˆæ‰¹é‡è½¬å½•è§†é¢‘å†…å®¹</p>
        </CardContent>
      </Card>
    )
  }

  return (
    <div className="space-y-6">
      {/* æ¦‚è§ˆå¡ç‰‡ */}
      <Card>
        <CardHeader>
          <div className="flex items-center justify-between">
            <CardTitle className="flex items-center gap-2">
              <FileText className="h-5 w-5" />
              æ–‡æ¡ˆåˆ†ææ¦‚è§ˆ
            </CardTitle>
            <Button
              variant="outline"
              size="sm"
              onClick={() => fetchInsights(true)}
              disabled={refreshing}
            >
              <RefreshCw className={`h-4 w-4 mr-2 ${refreshing ? 'animate-spin' : ''}`} />
              åˆ·æ–°
            </Button>
          </div>
        </CardHeader>
        <CardContent>
          <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div>
              <div className="text-sm text-muted-foreground">å·²è½¬å½•å†…å®¹</div>
              <div className="text-2xl font-bold">{data.summary.totalTranscripts}</div>
            </div>
            <div>
              <div className="text-sm text-muted-foreground">æ€»å­—æ•°</div>
              <div className="text-2xl font-bold">{(data.summary.totalWords / 10000).toFixed(1)}ä¸‡</div>
            </div>
            <div>
              <div className="text-sm text-muted-foreground">å¹³å‡å­—æ•°</div>
              <div className="text-2xl font-bold">{data.summary.avgWordsPerContent}</div>
            </div>
            <div>
              <div className="text-sm text-muted-foreground">è¦†ç›–ç‡</div>
              <div className="text-2xl font-bold">{Math.round(data.summary.coverageRate * 100)}%</div>
            </div>
          </div>
        </CardContent>
      </Card>

      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* é«˜é¢‘å…³é”®è¯ */}
        <Card>
          <CardHeader>
            <CardTitle>é«˜é¢‘å…³é”®è¯ TOP 10</CardTitle>
          </CardHeader>
          <CardContent className="space-y-3">
            {data.keywordCloud.slice(0, 10).map((item, index) => (
              <div key={item.keyword} className="flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <Badge variant="outline" className="text-xs">#{index + 1}</Badge>
                  <span className="font-medium">#{item.keyword}</span>
                  <span className="text-sm text-muted-foreground">Ã—{item.count}</span>
                </div>
                <div className="flex items-center gap-2">
                  <TrendingUp className="h-3 w-3 text-green-500" />
                  <span className="text-sm font-medium">
                    {(item.avgEngagement / 1000).toFixed(1)}k
                  </span>
                </div>
              </div>
            ))}
          </CardContent>
        </Card>

        {/* æƒ…ç»ªåˆ†æ */}
        <Card>
          <CardHeader>
            <CardTitle>æƒ…ç»ªåˆ†æ</CardTitle>
          </CardHeader>
          <CardContent className="space-y-4">
            <div className="space-y-3">
              <div>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm flex items-center gap-2">
                    <Smile className="h-4 w-4 text-green-500" />
                    æ­£é¢æƒ…ç»ª
                  </span>
                  <span className="font-medium">{Math.round(data.emotionalTone.positive * 100)}%</span>
                </div>
                <Progress value={data.emotionalTone.positive * 100} className="bg-green-100" />
              </div>

              <div>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm flex items-center gap-2">
                    <Meh className="h-4 w-4 text-gray-500" />
                    ä¸­æ€§æƒ…ç»ª
                  </span>
                  <span className="font-medium">{Math.round(data.emotionalTone.neutral * 100)}%</span>
                </div>
                <Progress value={data.emotionalTone.neutral * 100} className="bg-gray-100" />
              </div>

              <div>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm flex items-center gap-2">
                    <Frown className="h-4 w-4 text-red-500" />
                    è´Ÿé¢æƒ…ç»ª
                  </span>
                  <span className="font-medium">{Math.round(data.emotionalTone.negative * 100)}%</span>
                </div>
                <Progress value={data.emotionalTone.negative * 100} className="bg-red-100" />
              </div>
            </div>
          </CardContent>
        </Card>
      </div>

      {/* å¼€å¤´æ¨¡å¼åˆ†æ */}
      <Card>
        <CardHeader>
          <CardTitle>é«˜æ•ˆå¼€å¤´æ¨¡å¼</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            {data.openingPatterns.map((pattern) => (
              <div key={pattern.pattern} className="border rounded-lg p-4 space-y-2">
                <div className="font-medium">{pattern.pattern}</div>
                <div className="text-sm text-muted-foreground">
                  ä½¿ç”¨ {pattern.count} æ¬¡ Â· å¹³å‡äº’åŠ¨ {(pattern.avgEngagement / 1000).toFixed(1)}k
                </div>
                <div className="space-y-1">
                  {pattern.examples.map((ex, i) => (
                    <div key={i} className="text-xs text-muted-foreground bg-muted/50 rounded px-2 py-1">
                      "{ex}"
                    </div>
                  ))}
                </div>
              </div>
            ))}
          </div>
        </CardContent>
      </Card>
    </div>
  )
}
```

---

### Phase 4.1ï¼šè°ƒæ•´ Analytics é¡µé¢å¸ƒå±€

#### å®Œæ•´è°ƒæ•´æ–¹æ¡ˆ

**æ–‡ä»¶**ï¼š`app/merchants/[id]/analytics/page.tsx`

**ä¿®æ”¹åçš„ Tabs ç»“æ„**ï¼š

```tsx
<Tabs defaultValue="overview" className="w-full">
  <TabsList className="grid w-full grid-cols-5">
    <TabsTrigger value="overview">è´¦å·æ¦‚å†µ</TabsTrigger>
    <TabsTrigger value="engagement">äº’åŠ¨åˆ†æ</TabsTrigger>
    <TabsTrigger value="content">å†…å®¹åˆ†æ</TabsTrigger>
    <TabsTrigger value="copywriting">æ–‡æ¡ˆåˆ†æ</TabsTrigger>  {/* âœ… æ–°å¢ */}
    <TabsTrigger value="tags">æ ‡ç­¾åˆ†æ</TabsTrigger>
  </TabsList>

  {/* âœ… è´¦å·æ¦‚å†µ Tab */}
  <TabsContent value="overview" className="space-y-6">
    <AccountOverviewCard merchant={merchant} />
    {/* å¯é€‰ï¼šæ·»åŠ è¶‹åŠ¿å›¾è¡¨ */}
  </TabsContent>

  {/* ä¿ç•™åŸæœ‰ Tab */}
  <TabsContent value="engagement">
    {/* åŸæœ‰çš„äº’åŠ¨åˆ†æå†…å®¹ */}
  </TabsContent>

  <TabsContent value="content">
    {/* åŸæœ‰çš„å†…å®¹åˆ†æ */}
  </TabsContent>

  {/* âœ… æ–‡æ¡ˆåˆ†æ Tab */}
  <TabsContent value="copywriting" className="space-y-6">
    <CopywritingInsights merchantId={merchant.id} />
  </TabsContent>

  <TabsContent value="tags">
    {/* åŸæœ‰çš„æ ‡ç­¾åˆ†æ */}
  </TabsContent>
</Tabs>
```

---

## ğŸ“Š æ•°æ®æµç¨‹å›¾

### å®Œæ•´æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç”¨æˆ·æ“ä½œè§¦å‘ç‚¹                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  1. ç‚¹å‡»"æ‰¹é‡è½¬å½•"æŒ‰é’®                  â”‚
         â”‚     /merchants/[id]/batch-transcribe   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  2. POST /api/merchants/[id]/contents/ â”‚
         â”‚     batch-transcribe                   â”‚
         â”‚     - è·å–å†…å®¹åˆ—è¡¨                      â”‚
         â”‚     - è¿‡æ»¤å·²è½¬å½•å†…å®¹ï¼ˆmode=missingï¼‰    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  3. æ‰¹é‡å¤„ç†ï¼ˆé™æµï¼š3å¹¶å‘ï¼‰              â”‚
         â”‚     â”œâ”€ ä¸‹è½½è§†é¢‘ (TikHub API)           â”‚
         â”‚     â”œâ”€ æå–éŸ³é¢‘ (FFmpeg)               â”‚
         â”‚     â”œâ”€ GPT-4o è½¬å½•                     â”‚
         â”‚     â”œâ”€ Claude ä¼˜åŒ–æ–‡æ¡ˆ                  â”‚
         â”‚     â””â”€ æ›´æ–° MerchantContent            â”‚
         â”‚        (transcript, hasTranscript)     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  4. è‡ªåŠ¨è§¦å‘ï¼ˆå¯é€‰ï¼‰                    â”‚
         â”‚     POST /api/merchants/[id]/profile/  â”‚
         â”‚     generate                           â”‚
         â”‚     - æ›´æ–° AI åˆ›ä½œæ¡£æ¡ˆ                  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  5. æ¸…é™¤ç¼“å­˜                            â”‚
         â”‚     MerchantProfile.customBackground   â”‚
         â”‚     (æ–‡æ¡ˆåˆ†æç¼“å­˜å¤±æ•ˆ)                  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  6. ç”¨æˆ·è®¿é—®æ–‡æ¡ˆåˆ†æé¡µé¢                 â”‚
         â”‚     GET /api/merchants/[id]/           â”‚
         â”‚     copywriting-insights               â”‚
         â”‚     - æ£€æŸ¥ç¼“å­˜ï¼ˆ24hæœ‰æ•ˆæœŸï¼‰             â”‚
         â”‚     - æ— ç¼“å­˜åˆ™è°ƒç”¨ Claude åˆ†æ          â”‚
         â”‚     - è¿”å›ç»“æœå¹¶ç¼“å­˜                    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åŒæ­¥æ•°æ®æµï¼ˆé¿å…è¦†ç›–transcriptï¼‰

```
å®šæ—¶ä»»åŠ¡è§¦å‘ï¼ˆCronï¼‰
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /api/cron/sync-merchants â”‚
â”‚ - æŸ¥è¯¢ monitoringEnabled â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ lib/tikhub/sync-service  â”‚
â”‚ syncMerchantData()       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ lib/tikhub/mapper.ts                     â”‚
â”‚ mapVideoToMerchantContent(video, id, {   â”‚
â”‚   preserveTranscript: true  âœ… å…³é”®å‚æ•°   â”‚
â”‚ })                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Prisma Upsert                            â”‚
â”‚ - update: { title, diggCount, ... }      â”‚
â”‚   (ä¸åŒ…å«transcriptå’ŒhasTranscript)       â”‚
â”‚ - æ•°æ®åº“ä¿ç•™åŸæœ‰transcript âœ…             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” å…¼å®¹æ€§æ£€æŸ¥è¡¨

### ä¸ç°æœ‰ç»„ä»¶çš„å…¼å®¹æ€§

| ç°æœ‰ç»„ä»¶ | åŠŸèƒ½ | æ–°å¢åŠŸèƒ½ | å†²çªæ£€æµ‹ | è§£å†³æ–¹æ¡ˆ |
|---------|------|---------|---------|---------|
| MerchantProfileCard | AI åˆ›ä½œæ¡£æ¡ˆ | æ–‡æ¡ˆåˆ†æ | âœ… æ— å†²çª | å¹³è¡ŒåŠŸèƒ½ï¼Œäº’ä¸å¹²æ‰° |
| MonitoringConfig | å®šæ—¶åŒæ­¥é…ç½® | æ‰¹é‡è½¬å½• | âœ… æ— å†²çª | ç›‘æ§åŒæ­¥äº’åŠ¨æ•°æ®ï¼Œè½¬å½•å¤„ç†æ–‡æ¡ˆ |
| TagAnalysisModal | æ ‡ç­¾ç»Ÿè®¡ | å…³é”®è¯åˆ†æ | âš ï¸ æ•°æ®æºä¸åŒ | æ ‡ç­¾æ¥è‡ªAPIï¼Œå…³é”®è¯æ¥è‡ªtranscript |
| Analytics é¡µé¢ | 3ä¸ªTab | æ–°å¢2ä¸ªTab | âœ… æ— å†²çª | å¹³è¡Œæ‰©å±• |
| å†…å®¹åˆ—è¡¨ | å±•ç¤ºè§†é¢‘ | æ‰¹é‡è½¬å½•å…¥å£ | âœ… æ— å†²çª | æ·»åŠ æ‰¹é‡é€‰æ‹©åŠŸèƒ½ |

### æ•°æ®åº“å­—æ®µå…¼å®¹æ€§

| å­—æ®µ | å½“å‰ç”¨é€” | æ–°å¢ç”¨é€” | å†²çªé£é™© |
|------|---------|---------|---------|
| Merchant.totalContentCount | å†…å®¹æ€»æ•° | è®¡ç®—è¦†ç›–ç‡ | âœ… æ— å†²çª |
| Merchant.totalEngagement | äº’åŠ¨æ€»æ•° | è´¦å·æ¦‚å†µå±•ç¤º | âœ… æ— å†²çª |
| MerchantContent.transcript | å½“å‰ä¸ºnull | å­˜å‚¨è½¬å½•æ–‡æœ¬ | âœ… æ— å†²çª |
| MerchantContent.hasTranscript | å½“å‰ä¸ºfalse | æ ‡è®°å·²è½¬å½• | âœ… æ— å†²çª |
| MerchantProfile.customBackground | æœªä½¿ç”¨ | ç¼“å­˜æ–‡æ¡ˆåˆ†æç»“æœ | âš ï¸ éœ€ç¡®è®¤æœªè¢«å ç”¨ |

**é£é™©è¯„ä¼°**ï¼š
- `customBackground` å­—æ®µå½“å‰æœªåœ¨ä»£ç ä¸­ä½¿ç”¨ï¼ˆå·²å…¨æ–‡æœç´¢ç¡®è®¤ï¼‰
- å¦‚æœåç»­è¯¥å­—æ®µæœ‰å…¶ä»–ç”¨é€”ï¼Œéœ€è¦æ–°å¢ä¸“ç”¨å­—æ®µ `copywritingInsightsCache`

---

## ğŸš€ å®æ–½æ­¥éª¤æ£€æŸ¥æ¸…å•

### Phase 1ï¼šåŸºç¡€è®¾æ–½ï¼ˆ1-2å¤©ï¼‰

- [ ] åˆ›å»º `app/api/merchants/[id]/contents/batch-transcribe/route.ts`
  - [ ] å®ç°æ‰¹é‡è½¬å½•é€»è¾‘
  - [ ] æ·»åŠ å¹¶å‘æ§åˆ¶ï¼ˆ3å¹¶å‘ï¼‰
  - [ ] é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
  - [ ] è¿”å›è¯¦ç»†ç»“æœç»Ÿè®¡
- [ ] ä¿®æ”¹ `lib/tikhub/mapper.ts`
  - [ ] æ·»åŠ  `preserveTranscript` å‚æ•°
  - [ ] æ¡ä»¶æ€§è®¾ç½® transcript å­—æ®µ
- [ ] ä¿®æ”¹ `lib/tikhub/sync-service.ts`
  - [ ] è°ƒç”¨ mapper æ—¶ä¼ å…¥ `preserveTranscript: true`
- [ ] æµ‹è¯•éªŒè¯
  - [ ] æ–°è§†é¢‘åŒæ­¥ï¼štranscript ä¸ºç©º
  - [ ] å·²è½¬å½•è§†é¢‘åŒæ­¥ï¼štranscript ä¿ç•™
  - [ ] æ‰¹é‡è½¬å½•ï¼šæˆåŠŸç‡ > 90%

### Phase 2ï¼šè´¦å·æ¦‚å†µï¼ˆ1å¤©ï¼‰

- [ ] åˆ›å»º `components/merchants/account-overview-card.tsx`
  - [ ] å®ç°6ä¸ªæ ¸å¿ƒæŒ‡æ ‡å¡ç‰‡
  - [ ] è®¡ç®—è½¬å½•è¦†ç›–ç‡
  - [ ] æ ¼å¼åŒ–æ•°å­—æ˜¾ç¤º
  - [ ] å“åº”å¼å¸ƒå±€
- [ ] é›†æˆåˆ°è¯¦æƒ…é¡µ
  - [ ] åœ¨ `app/merchants/[id]/page.tsx` æ’å…¥ç»„ä»¶
  - [ ] æµ‹è¯•ç§»åŠ¨ç«¯/æ¡Œé¢ç«¯å¸ƒå±€
- [ ] é›†æˆåˆ° Analytics é¡µé¢
  - [ ] æ–°å¢"è´¦å·æ¦‚å†µ"Tab
  - [ ] æµ‹è¯• Tab åˆ‡æ¢

### Phase 3ï¼šæ–‡æ¡ˆåˆ†æï¼ˆ2-3å¤©ï¼‰

- [ ] åˆ›å»º `app/api/merchants/[id]/copywriting-insights/route.ts`
  - [ ] å®ç° AI æ–‡æ¡ˆåˆ†æé€»è¾‘
  - [ ] æ·»åŠ 24å°æ—¶ç¼“å­˜
  - [ ] è®¡ç®—å…³é”®è¯äº’åŠ¨æ•°æ®
- [ ] åˆ›å»º `components/merchants/copywriting-insights.tsx`
  - [ ] æ¦‚è§ˆå¡ç‰‡
  - [ ] é«˜é¢‘å…³é”®è¯å±•ç¤º
  - [ ] æƒ…ç»ªåˆ†æå¯è§†åŒ–
  - [ ] å¼€å¤´æ¨¡å¼å±•ç¤º
- [ ] é›†æˆåˆ° Analytics é¡µé¢
  - [ ] æ–°å¢"æ–‡æ¡ˆåˆ†æ"Tab
- [ ] è‡ªåŠ¨è§¦å‘æœºåˆ¶
  - [ ] æ‰¹é‡è½¬å½•å®Œæˆåæ¸…é™¤ç¼“å­˜
  - [ ] ï¼ˆå¯é€‰ï¼‰è‡ªåŠ¨æ›´æ–° AI æ¡£æ¡ˆ

### Phase 4ï¼šUI ä¼˜åŒ–ï¼ˆ1å¤©ï¼‰

- [ ] è°ƒæ•´ Analytics é¡µé¢
  - [ ] ä¿®æ”¹ TabsList ä¸º5åˆ—
  - [ ] ä¼˜åŒ–ç§»åŠ¨ç«¯ Tab å¸ƒå±€
- [ ] æ·»åŠ æ‰¹é‡è½¬å½•å…¥å£
  - [ ] å•†å®¶è¯¦æƒ…é¡µæ·»åŠ "æ‰¹é‡è½¬å½•"æŒ‰é’®
  - [ ] åˆ›å»ºæ‰¹é‡é€‰æ‹© UI
- [ ] æ–‡æ¡£æ›´æ–°
  - [ ] æ›´æ–° CLAUDE.md
  - [ ] æ·»åŠ ä½¿ç”¨è¯´æ˜

---

## âš ï¸ é£é™©è¯„ä¼°ä¸åº”å¯¹

### æŠ€æœ¯é£é™©

| é£é™© | å¯èƒ½æ€§ | å½±å“ | åº”å¯¹æ–¹æ¡ˆ |
|------|-------|------|---------|
| GPT-4o API é™æµ | é«˜ | ä¸­ | é™åˆ¶å¹¶å‘æ•°ä¸º3ï¼Œæ·»åŠ é‡è¯•æœºåˆ¶ |
| è§†é¢‘ä¸‹è½½å¤±è´¥ | ä¸­ | ä½ | è·³è¿‡å¤±è´¥é¡¹ï¼Œç»§ç»­å¤„ç†å…¶ä»– |
| è½¬å½•è´¨é‡å·® | ä¸­ | ä¸­ | ä½¿ç”¨ Claude ä¼˜åŒ–æ–‡æ¡ˆï¼Œæå‡å‡†ç¡®åº¦ |
| AI åˆ†æè¶…Token | ä½ | ä½ | é™åˆ¶åˆ†ææ–‡æœ¬æ€»é‡ä¸º50æ¡ |
| ç¼“å­˜æ•°æ®è¿‡æœŸ | ä½ | ä½ | 24å°æ—¶è‡ªåŠ¨å¤±æ•ˆï¼Œæ”¯æŒæ‰‹åŠ¨åˆ·æ–° |

### ä¸šåŠ¡é£é™©

| é£é™© | å¯èƒ½æ€§ | å½±å“ | åº”å¯¹æ–¹æ¡ˆ |
|------|-------|------|---------|
| æ‰¹é‡è½¬å½•æˆæœ¬é«˜ | é«˜ | é«˜ | ä»…ç®¡ç†å‘˜å¯æ“ä½œï¼Œæ·»åŠ æˆæœ¬é¢„ä¼°æç¤º |
| ç”¨æˆ·è¯¯è¦†ç›–è½¬å½• | ä½ | ä¸­ | mode=missing é»˜è®¤è·³è¿‡å·²è½¬å½•å†…å®¹ |
| æ–‡æ¡ˆåˆ†æä¸å‡†ç¡® | ä¸­ | ä¸­ | æ”¯æŒæ‰‹åŠ¨åˆ·æ–°ï¼ŒAI Prompt æŒç»­ä¼˜åŒ– |

### æ€§èƒ½é£é™©

| é£é™© | å¯èƒ½æ€§ | å½±å“ | åº”å¯¹æ–¹æ¡ˆ |
|------|-------|------|---------|
| æ‰¹é‡è½¬å½•é˜»å¡ | ä½ | ä¸­ | ä½¿ç”¨åå°ä»»åŠ¡é˜Ÿåˆ—ï¼ˆPhase 1.3ï¼‰ |
| æ–‡æ¡ˆåˆ†ææ…¢ | ä¸­ | ä½ | æ·»åŠ 24å°æ—¶ç¼“å­˜ï¼Œä¼˜å…ˆè¿”å›ç¼“å­˜ |
| æ•°æ®åº“æŸ¥è¯¢æ…¢ | ä½ | ä½ | å·²æœ‰ç´¢å¼•ä¼˜åŒ–ï¼ˆmerchantId, hasTranscriptï¼‰ |

---

## ğŸ“ˆ åç»­ä¼˜åŒ–æ–¹å‘

### çŸ­æœŸä¼˜åŒ–ï¼ˆ1-2å‘¨ï¼‰

1. **æ‰¹é‡è½¬å½• UI ä¼˜åŒ–**
   - æ·»åŠ è¿›åº¦æ¡
   - æ”¯æŒæš‚åœ/æ¢å¤
   - å¤±è´¥é¡¹é‡è¯•æŒ‰é’®

2. **æ–‡æ¡ˆåˆ†æå¢å¼º**
   - æ·»åŠ æ—¶é—´ç»´åº¦åˆ†æï¼ˆè¿‘30å¤© vs å†å²ï¼‰
   - å¯¹æ ‡è´¦å·æ–‡æ¡ˆå¯¹æ¯”
   - å¯¼å‡ºæ–‡æ¡ˆåˆ†ææŠ¥å‘Š

3. **ç›‘æ§è”åŠ¨**
   - è‡ªåŠ¨ç›‘æ§æ–°å¢è§†é¢‘å¹¶è½¬å½•
   - å®šæ—¶æ›´æ–°æ–‡æ¡ˆåˆ†æç¼“å­˜

### ä¸­æœŸä¼˜åŒ–ï¼ˆ1-2æœˆï¼‰

1. **ä»»åŠ¡é˜Ÿåˆ—ç³»ç»Ÿ**
   - å¼•å…¥ BullMQ + Redis
   - æ”¯æŒå¤§è§„æ¨¡æ‰¹é‡è½¬å½•
   - å¤±è´¥é‡è¯•å’Œé”™è¯¯æ¢å¤

2. **AI æ¡£æ¡ˆè‡ªåŠ¨æ›´æ–°**
   - è½¬å½•å®Œæˆåè‡ªåŠ¨è§¦å‘æ¡£æ¡ˆç”Ÿæˆ
   - æ–‡æ¡ˆæ´å¯Ÿè‡ªåŠ¨è¡¥å……åˆ°æ¡£æ¡ˆ

3. **æ•°æ®å¯è§†åŒ–**
   - ç²‰ä¸å¢é•¿è¶‹åŠ¿å›¾
   - äº’åŠ¨ç‡è¶‹åŠ¿å›¾
   - å…³é”®è¯äº‘å›¾

### é•¿æœŸä¼˜åŒ–ï¼ˆ3-6æœˆï¼‰

1. **æ™ºèƒ½æ¨è**
   - åŸºäºæ–‡æ¡ˆåˆ†ææ¨èçƒ­é—¨è¯é¢˜
   - æ¨èé«˜æ•ˆå¼€å¤´æ¨¡æ¿

2. **å¤šå¹³å°æ”¯æŒ**
   - æ”¯æŒå°çº¢ä¹¦ã€Bç«™ç­‰å¹³å°
   - ç»Ÿä¸€çš„æ–‡æ¡ˆåˆ†ææ¡†æ¶

3. **åä½œåŠŸèƒ½**
   - å›¢é˜Ÿæˆå‘˜æ‰¹æ³¨æ–‡æ¡ˆ
   - ç‰ˆæœ¬å†å²ç®¡ç†

---

## ğŸ“š å‚è€ƒèµ„æ–™

### ç°æœ‰ä»£ç ä½ç½®

| åŠŸèƒ½ | æ–‡ä»¶è·¯å¾„ |
|------|---------|
| è½¬å½•æŠ€æœ¯æ ˆ | `app/api/douyin/extract-text/route.ts` |
| æ•°æ®æ˜ å°„ | `lib/tikhub/mapper.ts` |
| åŒæ­¥æœåŠ¡ | `lib/tikhub/sync-service.ts` |
| å•†å®¶è¯¦æƒ…é¡µ | `app/merchants/[id]/page.tsx` |
| Analytics é¡µé¢ | `app/merchants/[id]/analytics/page.tsx` |
| AI æ¡£æ¡ˆ | `components/merchants/merchant-profile-card.tsx` |
| æ•°æ®åº“ Schema | `prisma/schema.prisma` |

### ä¾èµ–æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç”¨é€” |
|------|------|
| GPT-4o Audio Preview | è§†é¢‘è½¬å½• |
| Claude Sonnet 4.5 | æ–‡æ¡ˆä¼˜åŒ–ã€åˆ†æ |
| FFmpeg (VideoProcessor) | éŸ³é¢‘æå– |
| Prisma | æ•°æ®åº“æ“ä½œ |
| React Query (å¯é€‰) | æ•°æ®ç¼“å­˜ |

---

## âœ… æ€»ç»“

### æ ¸å¿ƒä»·å€¼

1. **æ‰“é€šæ•°æ®æ–­ç‚¹** - transcript ä»"åªè¿”å›å‰ç«¯"åˆ°"å…¥åº“+AIåˆ†æ"
2. **å¤ç”¨ç°æœ‰æ¶æ„** - ä¸ç ´å Merchant èšåˆå­—æ®µã€MerchantProfileã€Analytics é¡µé¢
3. **æ¸è¿›å¼å®æ–½** - åˆ†4ä¸ªPhaseï¼Œå¯ç‹¬ç«‹ä¸Šçº¿ï¼Œé™ä½é£é™©

### æŠ€æœ¯äº®ç‚¹

- âœ… å¢é‡æ›´æ–°è®¾è®¡ï¼ˆ`preserveTranscript` å‚æ•°ï¼‰
- âœ… å¹¶å‘æ§åˆ¶ï¼ˆé¿å… API é™æµï¼‰
- âœ… æ™ºèƒ½ç¼“å­˜ï¼ˆ24å°æ—¶æœ‰æ•ˆæœŸï¼‰
- âœ… é”™è¯¯éš”ç¦»ï¼ˆå•æ¡å¤±è´¥ä¸å½±å“å…¶ä»–ï¼‰
- âœ… UI ç»„ä»¶åŒ–ï¼ˆAccountOverviewCardã€CopywritingInsights å¯ç‹¬ç«‹å¤ç”¨ï¼‰

### é¢„æœŸæ•ˆæœ

- ğŸ“Š **è´¦å·æ¦‚å†µ**ï¼šä¸€å±å±•ç¤º6ä¸ªæ ¸å¿ƒæŒ‡æ ‡ï¼Œæ›¿ä»£åˆ†æ•£çš„æ•°æ®ç»Ÿè®¡
- ğŸ“ **æ–‡æ¡ˆåˆ†æ**ï¼šAI é©±åŠ¨çš„å…³é”®è¯ã€æƒ…ç»ªã€å¼€å¤´æ¨¡å¼æ´å¯Ÿ
- ğŸ”„ **æ•°æ®åŒæ­¥**ï¼štranscript æ°¸ä¹…ä¿ç•™ï¼Œä¸è¢«è¦†ç›–
- ğŸš€ **æ‰©å±•æ€§**ï¼šä¸ºåç»­"æ™ºèƒ½æ¨è"ã€"å¯¹æ ‡åˆ†æ"æ‰“å¥½åœ°åŸº
