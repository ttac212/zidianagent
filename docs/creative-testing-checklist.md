# 批量文案生成系统 - 测试清单

## 自动化测试

### 1. 运行测试脚本
```bash
npx tsx scripts/test-creative-flow.ts
```

**验证点**：
- ✅ 创建商家和资料成功
- ✅ 创建批次和文案成功
- ✅ 文案编辑和版本管理正常
- ✅ 资料版本管理正常

---

## 手动测试清单

### A. 批次列表页（`/creative/batches`）

#### 基本功能
- [ ] 页面正常加载
- [ ] 批次列表正确显示
- [ ] 状态 Badge 显示正确（QUEUED/RUNNING/SUCCEEDED/PARTIAL_SUCCESS/FAILED）
- [ ] 点击"查看详情"跳转到详情页

#### 响应式
- [ ] 桌面端布局正常
- [ ] 移动端布局正常（卡片堆叠）

---

### B. 批次详情页（`/creative/batches/:batchId`）

#### 批次信息卡片
- [ ] 状态 Badge 正确显示
- [ ] 模型、创建时间、Token用量、文案数量正确显示
- [ ] 完成时间显示（如已完成）
- [ ] 错误信息显示（如失败）

#### SSE 实时推送
- [ ] 实时连接状态显示（绿点 + "实时连接"）
- [ ] 批次状态变化时自动更新
- [ ] 文案数量变化时自动刷新
- [ ] 完成时显示 Toast 通知

#### 文案卡片
- [ ] Markdown 正确渲染
- [ ] 状态 Badge 正确（草稿/已通过/已拒绝）
- [ ] 版本号显示（v2+）
- [ ] 复制到剪贴板功能正常
- [ ] 编辑按钮正常
- [ ] 重新生成按钮正常
- [ ] 更多菜单正常（标记通过/拒绝/版本历史）

#### 文案编辑对话框
- [ ] 桌面端双栏布局（编辑器 | 预览）
- [ ] 移动端 Tab 切换（编辑 / 预览）
- [ ] Markdown 实时预览正常
- [ ] 修改说明输入框正常
- [ ] 保存后版本递增
- [ ] 取消按钮正常

#### 单条重新生成对话框
- [ ] 当前内容预览正确
- [ ] 生成模式选择正常（完全重新 / 基于改进）
- [ ] 补充要求输入框正常
- [ ] Token 估算显示
- [ ] 生成后跳转到新批次

#### 整批重新生成对话框
- [ ] 批次信息显示正确
- [ ] 补充提示词输入框正常
- [ ] Token 估算显示
- [ ] 生成后跳转到新批次

#### 版本历史对话框
- [ ] 左侧版本列表正确显示（降序）
- [ ] 默认选中最新版本
- [ ] 右侧内容预览正确
- [ ] 备注显示正常
- [ ] 来源标签正确（AI生成/手动编辑/重新生成）

#### 批次操作菜单
- [ ] 导出 Markdown 功能正常
- [ ] 归档批次功能正常
- [ ] 删除批次功能正常（确认对话框）
- [ ] 归档/删除后跳转到列表页

#### 响应式
- [ ] 桌面端 3 列 Grid
- [ ] 平板端 2 列 Grid
- [ ] 移动端 1 列堆叠
- [ ] 所有对话框移动端可用

---

### C. 资料管理页（`/creative/merchants/:merchantId/assets`）

#### Tabs 切换
- [ ] 商家报告 Tab 正常
- [ ] 提示词模板 Tab 正常
- [ ] 附件素材 Tab 显示提示信息

#### 版本卡片
- [ ] 标题、版本号、创建时间正确显示
- [ ] 当前版本 Badge 正确显示
- [ ] 内容预览正确（前150字）
- [ ] 查看按钮正常
- [ ] 编辑按钮正常
- [ ] 设为当前版本按钮正常（非当前版本显示）

#### 创建资料对话框
- [ ] 标题输入框正常
- [ ] 内容输入框正常（Textarea）
- [ ] 设为当前版本开关正常
- [ ] 创建成功后刷新列表
- [ ] 取消按钮正常

#### 编辑资料对话框
- [ ] 预填充原有数据
- [ ] 标题和内容可修改
- [ ] 保存后创建新版本
- [ ] 新版本号正确递增

#### 查看资料对话框
- [ ] 完整内容正确显示
- [ ] 版本号、创建时间、创建人正确显示
- [ ] 当前版本 Badge 正确显示
- [ ] 滚动条正常

#### 设为当前版本
- [ ] 点击后按钮消失
- [ ] 其他版本的"当前版本" Badge 消失
- [ ] Toast 通知显示

#### 响应式
- [ ] 桌面端 2 列 Grid
- [ ] 移动端 1 列堆叠

---

### D. 事务和并发测试

#### 资料版本冲突
- [ ] 同时创建多个版本，版本号正确递增（无冲突）
- [ ] 同时设置多个版本为当前，只有一个生效
- [ ] P2002 错误自动重试（最多5次）

#### 批次删除
- [ ] 删除批次后，文案、版本记录全部删除
- [ ] 资料不受影响（软删除）
- [ ] 事务保证一致性

---

### E. 性能测试

#### 大量文案
- [ ] 100+ 条文案时虚拟滚动正常（如适用）
- [ ] Markdown 渲染性能正常

#### SSE 连接
- [ ] 长时间连接稳定
- [ ] 心跳包正常
- [ ] 断开自动重连

---

### F. 边界情况测试

#### 空状态
- [ ] 无批次时显示提示
- [ ] 无文案时显示提示
- [ ] 无资料时显示提示

#### 错误状态
- [ ] API 错误显示 Toast 提示
- [ ] 加载失败显示错误 Alert + 重试按钮
- [ ] 认证失败正确处理

#### 特殊字符
- [ ] Markdown 中的特殊字符正确转义
- [ ] 文案标题包含 emoji 正常显示
- [ ] 备注包含换行符正常显示

---

## 测试环境准备

### 1. 启动开发服务器
```bash
pnpm dev
```

### 2. 运行测试脚本（创建测试数据）
```bash
npx tsx scripts/test-creative-flow.ts
```

### 3. 测试用账号
- 邮箱：任意邮箱
- 密码：`DEV_LOGIN_CODE`（开发环境）

---

## 测试结果记录

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 批次列表页 | ⏳ | |
| 批次详情页 | ⏳ | |
| 资料管理页 | ⏳ | |
| SSE 实时推送 | ⏳ | |
| 文案编辑 | ⏳ | |
| 版本历史 | ⏳ | |
| 批次操作 | ⏳ | |
| 移动端响应式 | ⏳ | |
| 事务测试 | ⏳ | |

**图例**: ⏳ 待测试 | ✅ 通过 | ❌ 失败 | ⚠️ 部分通过

---

## 问题记录

| 问题描述 | 严重性 | 状态 | 负责人 |
|----------|--------|------|--------|
| _待填写_ | | | |

---

## 测试完成标准

- [ ] 所有 P0 功能测试通过
- [ ] 所有 P1 功能测试通过
- [ ] P2 功能已验证（或标记为已知限制）
- [ ] 移动端响应式测试通过
- [ ] 事务和并发测试通过
- [ ] 无致命性能问题
- [ ] 无致命 Bug

---

**测试人员**: _________  
**测试日期**: _________  
**版本号**: P0+P1+P2 (2025-01-15)
