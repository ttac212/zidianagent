# å•†å®¶åˆ›ä½œæ¡£æ¡ˆåŠŸèƒ½ - æŠ€æœ¯å®æ–½æ–¹æ¡ˆ

## ä¸€ã€éœ€æ±‚æ¦‚è¿°

### æ ¸å¿ƒç›®æ ‡
ä¸ºå•†å®¶ç”Ÿæˆç»“æ„åŒ–çš„åˆ›ä½œæ¡£æ¡ˆï¼Œè¡¥å…¨AIå’Œåˆ›ä½œè€…ä¹‹é—´çš„ä¿¡æ¯å·®ï¼Œæä¾›çŸ­è§†é¢‘åˆ›ä½œæ‰€éœ€çš„å•†å®¶èƒŒæ™¯èµ„æ–™ã€‚

### è®¾è®¡æ¼”è¿›å†ç¨‹ï¼ˆå››è½®å¯¹é½ï¼‰

**ç¬¬ä¸€è½®ï¼š** æ˜ç¡®æ¡£æ¡ˆç›®çš„æ˜¯"è¡¥å…¨ä¿¡æ¯å·®"ï¼Œé¢å‘AIå’Œåˆ›ä½œè€…
**ç¬¬äºŒè½®ï¼š** ç¡®å®šæ··åˆæ¨¡å¼ï¼ˆAIç”Ÿæˆ + ç”¨æˆ·ç¼–è¾‘ï¼‰ï¼Œé€‰æ‹©æŠ˜å å¡ç‰‡UIæ–¹æ¡ˆ
**ç¬¬ä¸‰è½®ï¼š** åˆæ­¥è®¾è®¡5ä¸ªAIåˆ†æå­—æ®µï¼ˆå•†å®¶æ€»ç»“ã€çˆ†æ¬¾ç‰¹å¾ã€å—ä¼—åå¥½ç­‰ï¼‰
**ç¬¬å››è½®ï¼š** ğŸ”¥ **å…³é”®è½¬æŠ˜** - åŸºäº2025å¹´æŠ–éŸ³åˆ›ä½œçœŸå®éœ€æ±‚è°ƒç ”ï¼Œä»"æ³›æ³›åˆ†æ"é‡æ„ä¸º"å¯ç›´æ¥ä½¿ç”¨çš„åˆ›ä½œç®€æŠ¥(Brief)"

**å…³é”®æ´å¯Ÿï¼ˆç¬¬å››è½®ï¼‰ï¼š**
- âŒ æ—§è®¾è®¡ï¼š"å•†å®¶æ€»ç»“"ã€"å—ä¼—åå¥½" â†’ æ³›æ³›è€Œè°ˆï¼Œåˆ›ä½œè€…ä»éœ€è‡ªå·±æç‚¼
- âœ… æ–°è®¾è®¡ï¼š"Brief"ã€"é»„é‡‘3ç§’æ¨¡æ¿"ã€"æƒ…ç»ªç‚¹åˆ†å¸ƒ" â†’ å¯ç›´æ¥å¥—ç”¨çš„åˆ›ä½œæŒ‡å—
- ğŸ“Š è°ƒç ”æ¥æºï¼šæŠ–éŸ³çˆ†æ¬¾è„šæœ¬ç»“æ„ã€åˆ›ä½œè€…Briefæ ¼å¼ã€é»„é‡‘3ç§’å¿ƒç†å­¦

### è®¾è®¡åŸåˆ™
- âœ… **æ•°æ®ç»“æ„ä¼˜å…ˆ**ï¼š"Bad programmers worry about the code. Good programmers worry about data structures." - å…ˆç¡®è®¤çœŸå®éœ€æ±‚ï¼Œå†è®¾è®¡æ•°æ®ç»“æ„
- âœ… **æ•°æ®æ¸…æ™°åˆ†ç¦»**ï¼šAIç”Ÿæˆå†…å®¹ä¸ç”¨æˆ·ç¼–è¾‘å†…å®¹ç‰©ç†åˆ†ç¦»ï¼Œæ— éœ€å¤æ‚åˆ¤æ–­é€»è¾‘
- âœ… **æ— ç‰¹æ®Šæƒ…å†µ**ï¼šåˆ·æ–°æ—¶AIå­—æ®µç›´æ¥è¦†ç›–ï¼Œç”¨æˆ·å­—æ®µæ°¸ä¹…ä¿ç•™ï¼Œæ¶ˆé™¤æ¡ä»¶åˆ†æ”¯
- âœ… **ç®€å•ä¼˜å…ˆ**ï¼šæ— ç‰ˆæœ¬æ§åˆ¶ã€æ— å¤šäººåä½œã€æ— å®¡æ‰¹æµç¨‹
- âœ… **å®ç”¨ä¸»ä¹‰**ï¼šè§£å†³çœŸå®é—®é¢˜ï¼ˆä¿¡æ¯å·®ï¼‰ï¼Œæ‹’ç»é—­é—¨é€ è½¦

---

## äºŒã€æ•°æ®åº“è®¾è®¡

### è®¾è®¡æ¼”è¿›è¯´æ˜

**ç¬¬å››è½®å¯¹é½è°ƒæ•´ï¼š** åŸºäº2025å¹´æŠ–éŸ³çŸ­è§†é¢‘åˆ›ä½œçœŸå®éœ€æ±‚çš„è°ƒç ”ï¼Œé‡æ–°è®¾è®¡æ¡£æ¡ˆç»“æ„ï¼Œä»"æ³›æ³›çš„åˆ†æ"è½¬å˜ä¸º"å¯ç›´æ¥ä½¿ç”¨çš„åˆ›ä½œç®€æŠ¥(Brief)"ã€‚

### æ–°å¢è¡¨ï¼šMerchantProfile

```prisma
model MerchantProfile {
  id         String   @id @default(cuid())
  merchantId String   @unique
  merchant   Merchant @relation(fields: [merchantId], references: [id], onDelete: Cascade)

  // === PART 1: å•†å®¶Briefï¼ˆåˆ›ä½œç®€æŠ¥ï¼‰ ===
  briefIntro           String?   // å•†å®¶ä»‹ç»ï¼ˆ3å¥è¯ï¼šæ˜¯è°ã€åšä»€ä¹ˆã€æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼‰
  briefSellingPoints   String?   // æ ¸å¿ƒå–ç‚¹ï¼ˆJSONæ•°ç»„ï¼š3-5ä¸ªäº§å“å–ç‚¹ï¼‰
  briefUsageScenarios  String?   // ä½¿ç”¨åœºæ™¯å’Œç—›ç‚¹ï¼ˆJSONæ•°ç»„ï¼‰
  briefAudienceProfile String?   // ç›®æ ‡ç”¨æˆ·ç”»åƒï¼ˆå¹´é¾„ã€æ€§åˆ«ã€å…´è¶£ã€æ¶ˆè´¹ä¹ æƒ¯ï¼‰
  briefBrandTone       String?   // å“ç‰Œè°ƒæ€§ï¼ˆæ­£ç»/æç¬‘/æ¸©æƒ…/ä¸“ä¸š + å…·ä½“æè¿°ï¼‰

  // === PART 2: çˆ†æ¬¾åˆ†æ ===
  topContentAnalysis   String?   // TOP10çˆ†æ¬¾åˆ†æï¼ˆJSON: æ ‡é¢˜ã€å¼€å¤´ã€æƒ…ç»ªç‚¹ã€äº’åŠ¨æ•°æ®ï¼‰
  goldenThreeSeconds   String?   // é»„é‡‘3ç§’å¼€å¤´å»ºè®®ï¼ˆåŸºäºå†å²æ•°æ®çš„æœ‰æ•ˆå¼€å¤´æ¨¡æ¿ï¼‰
  emotionalTriggers    String?   // æƒ…ç»ªç‚¹åˆ†æï¼ˆç¬‘ç‚¹/ç—›ç‚¹/çˆ½ç‚¹çš„åˆ†å¸ƒï¼‰
  contentFormats       String?   // å†…å®¹å½¢å¼åå¥½ï¼ˆå£æ’­/å‰§æƒ…/å¯¹æ¯”/æ•™ç¨‹çš„å æ¯”ï¼‰

  // === PART 3: åˆ›ä½œæŒ‡å— ===
  trendingTopics       String?   // çƒ­é—¨è¯é¢˜å’Œæ ‡ç­¾ï¼ˆå½“å‰é€‚åˆçš„çƒ­ç‚¹ï¼‰
  tagStrategy          String?   // æ ‡ç­¾ç»„åˆç­–ç•¥ï¼ˆé«˜æ•ˆæ ‡ç­¾ç»„åˆå»ºè®®ï¼‰
  publishingTips       String?   // å‘å¸ƒç­–ç•¥ï¼ˆæœ€ä½³æ—¶æ®µã€å†…å®¹é¢‘ç‡ï¼ŒJSONæ ¼å¼ï¼‰
  creativeAdvice       String?   // åˆ›ä½œå»ºè®®ï¼ˆ3-5æ¡å¯æ‰§è¡Œçš„å»ºè®®ï¼ŒJSONæ•°ç»„ï¼‰

  // === å…ƒæ•°æ® ===
  aiGeneratedAt  DateTime? // AIç”Ÿæˆæ—¶é—´
  aiModelUsed    String?   // ä½¿ç”¨çš„æ¨¡å‹ID
  aiTokenUsed    Int       @default(0) // æ¶ˆè€—çš„tokenæ•°

  // === ç”¨æˆ·ç¼–è¾‘éƒ¨åˆ†ï¼ˆæ°¸ä¹…ä¿ç•™ï¼‰ ===
  customBackground     String?   // å•†å®¶èƒŒæ™¯æ•…äº‹ï¼ˆè€æ¿ã€åˆ›ä¸šå†ç¨‹ç­‰ï¼‰
  customOfflineInfo    String?   // çº¿ä¸‹ä¿¡æ¯ï¼ˆå®ä½“åº—ã€åœ°ç†ä¼˜åŠ¿ç­‰ï¼‰
  customProductDetails String?   // äº§å“è¯¦ç»†ä¿¡æ¯ï¼ˆAIä¸çŸ¥é“çš„ç»†èŠ‚ï¼‰
  customDosAndDonts    String?   // ç¦å¿Œæ¸…å•å’Œå¿…å¼ºè°ƒç‚¹ï¼ˆç¦å¿Œè¯ã€å¿…é¡»æåŠçš„ç‚¹ï¼‰

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([merchantId])
  @@map("merchant_profiles")
}
```

### ä¿®æ”¹è¡¨ï¼šMerchant

åœ¨ `Merchant` model ä¸­æ·»åŠ å…³è”ï¼š

```prisma
model Merchant {
  // ... ç°æœ‰å­—æ®µ
  profile MerchantProfile? // ä¸€å¯¹ä¸€å…³ç³»
}
```

### æ•°æ®åº“è¿ç§»å‘½ä»¤

```bash
pnpm db:generate
pnpm db:push  # å¼€å‘ç¯å¢ƒ
```

---

## ä¸‰ã€AIç”Ÿæˆé€»è¾‘

### æ¨¡å‹é€‰æ‹©

**æ¨èï¼šClaude Haiku æˆ– Gemini Flash**

| æ¨¡å‹ | è¾“å…¥æˆæœ¬ | è¾“å‡ºæˆæœ¬ | å•æ¬¡é¢„ä¼° | é€Ÿåº¦ |
|------|---------|---------|---------|------|
| Claude Haiku | $0.25/1M | $1.25/1M | ~$0.0008 | 2-3ç§’ |
| Gemini Flash | $0.075/1M | $0.30/1M | ~$0.0003 | 1-2ç§’ |

**ä¸ä½¿ç”¨ï¼š** Claude Sonnet/Opusï¼ˆæˆæœ¬é«˜10å€ï¼Œæ€§èƒ½è¿‡å‰©ï¼‰

### Promptè®¾è®¡ï¼ˆåŸºäº2025å¹´æŠ–éŸ³åˆ›ä½œçœŸå®éœ€æ±‚ï¼‰

#### System Prompt

```
ä½ æ˜¯ä¸€ä¸ªæŠ–éŸ³çŸ­è§†é¢‘æ–‡æ¡ˆåˆ›ä½œä¸“å®¶ï¼Œæ‹¥æœ‰10å¹´å•†ä¸šçŸ­è§†é¢‘åˆ›ä½œç»éªŒã€‚
ä½ çš„ä»»åŠ¡æ˜¯ä¸ºåˆ›ä½œè€…ç”Ÿæˆä¸€ä»½å®Œæ•´çš„"åˆ›ä½œç®€æŠ¥(Brief)"ï¼Œè®©ä»–ä»¬èƒ½å¤Ÿå¿«é€Ÿäº†è§£å•†å®¶å¹¶åˆ›ä½œå‡ºçˆ†æ¬¾è„šæœ¬ã€‚

è¾“å‡ºè¦æ±‚ï¼š
1. ä½¿ç”¨åˆ›ä½œè€…ç†Ÿæ‚‰çš„Briefæ ¼å¼ï¼ŒåŒ…å«å“ç‰Œä»‹ç»ã€å–ç‚¹ã€ç”¨æˆ·ç”»åƒã€è°ƒæ€§
2. æä¾›å¯ç›´æ¥å¥—ç”¨çš„"é»„é‡‘3ç§’å¼€å¤´æ¨¡æ¿"ï¼ˆåŸºäºçˆ†æ¬¾æ•°æ®åˆ†æï¼‰
3. åˆ†ææƒ…ç»ªç‚¹ï¼ˆç¬‘ç‚¹/ç—›ç‚¹/çˆ½ç‚¹ï¼‰çš„åˆ†å¸ƒï¼ŒæŒ‡å¯¼åˆ›ä½œæ–¹å‘
4. åŸºäºæ•°æ®ç»™å‡ºå…·ä½“å»ºè®®ï¼Œä¸è¦æ³›æ³›è€Œè°ˆ
5. å¦‚æœæ•°æ®ä¸è¶³ï¼ˆå†…å®¹æ•°<5ï¼‰ï¼Œæ˜ç¡®æŒ‡å‡ºå¹¶ç»™å‡ºæœ‰é™å»ºè®®
6. å¿…é¡»ä½¿ç”¨JSONæ ¼å¼è¾“å‡ºï¼Œä¾¿äºç¨‹åºè§£æ

JSONè¾“å‡ºæ ¼å¼ä¸¥æ ¼éµå¾ªä¸‹æ–¹ç¤ºä¾‹ç»“æ„ã€‚
```

#### User Promptï¼ˆå®Œæ•´JSONç»“æ„ï¼‰

```
å•†å®¶åŸºæœ¬ä¿¡æ¯ï¼š
- åç§°ï¼š{merchant.name}
- ä¸šåŠ¡ç±»å‹ï¼š{merchant.businessType}ï¼ˆB2B/B2C/B2B2Cï¼‰
- åœ°åŒºï¼š{merchant.location}
- åˆ†ç±»ï¼š{merchant.category?.name}
- æ€»å†…å®¹æ•°ï¼š{merchant.totalContentCount}
- æ€»ç‚¹èµï¼š{merchant.totalDiggCount}
- æ€»è¯„è®ºï¼š{merchant.totalCommentCount}
- æ€»åˆ†äº«ï¼š{merchant.totalShareCount}

TOP10çˆ†æ¬¾å†…å®¹è¯¦ç»†æ•°æ®ï¼š
{top10Contents.map((c, idx) => `
[ç¬¬${idx+1}å]
- æ ‡é¢˜ï¼š${c.title}
- å‰3ç§’æ–‡æ¡ˆï¼š${c.transcript?.substring(0, 50) || 'æ— è½¬å½•'}
- äº’åŠ¨æ•°æ®ï¼šèµ${c.diggCount} | è¯„${c.commentCount} | è—${c.collectCount} | è½¬${c.shareCount}
- æ ‡ç­¾ï¼š${c.parsedTags?.join(', ') || 'æ— '}
- æ—¶é•¿ï¼š${c.duration}
- å‘å¸ƒæ—¶é—´ï¼š${c.publishedAt}
- å†…å®¹ç±»å‹ï¼š${c.contentType}
`).join('\n')}

è¯·ä¸¥æ ¼æŒ‰ä»¥ä¸‹JSONç»“æ„ç”Ÿæˆæ¡£æ¡ˆï¼š

{
  "brief": {
    "intro": "3å¥è¯ä»‹ç»å•†å®¶ï¼ˆç¬¬1å¥ï¼šæ˜¯è°ï¼›ç¬¬2å¥ï¼šåšä»€ä¹ˆä¸šåŠ¡ï¼›ç¬¬3å¥ï¼šæœ‰ä»€ä¹ˆç‰¹ç‚¹æˆ–ä¼˜åŠ¿ï¼‰",
    "sellingPoints": ["æ ¸å¿ƒå–ç‚¹1", "æ ¸å¿ƒå–ç‚¹2", "æ ¸å¿ƒå–ç‚¹3"],
    "usageScenarios": [
      "ä½¿ç”¨åœºæ™¯1 + è§£å†³çš„ç—›ç‚¹",
      "ä½¿ç”¨åœºæ™¯2 + è§£å†³çš„ç—›ç‚¹"
    ],
    "audienceProfile": {
      "age": "ä¸»è¦å¹´é¾„æ®µï¼ˆå¦‚ï¼š25-35å²ï¼‰",
      "gender": "æ€§åˆ«åˆ†å¸ƒï¼ˆå¦‚ï¼šå¥³æ€§ä¸ºä¸»70%ï¼‰",
      "interests": ["å…´è¶£æ ‡ç­¾1", "å…´è¶£æ ‡ç­¾2", "å…´è¶£æ ‡ç­¾3"],
      "behaviors": "æ¶ˆè´¹ä¹ æƒ¯å’Œè¡Œä¸ºç‰¹å¾çš„ç®€è¦æè¿°"
    },
    "brandTone": "å“ç‰Œè°ƒæ€§ç±»å‹ï¼ˆæ­£ç»/æç¬‘/æ¸©æƒ…/ä¸“ä¸šï¼‰+ ä¸€å¥è¯å…·ä½“æè¿°"
  },
  "viralAnalysis": {
    "topContents": [
      {
        "rank": 1,
        "title": "æ ‡é¢˜",
        "opening": "å‰3ç§’æ–‡æ¡ˆ",
        "emotionType": "ç¬‘ç‚¹/ç—›ç‚¹/çˆ½ç‚¹/çŸ¥è¯†ç‚¹",
        "format": "å£æ’­/å‰§æƒ…/å¯¹æ¯”/æ•™ç¨‹/æ¢åº—",
        "engagement": äº’åŠ¨æ€»æ•°
      }
      // ... TOP5å³å¯
    ],
    "goldenThreeSeconds": [
      "å¼€å¤´æ¨¡æ¿1ï¼ˆåŸºäºTOP1æ¡ˆä¾‹æå–çš„å¯ç›´æ¥å¥—ç”¨å¥å¼ï¼‰",
      "å¼€å¤´æ¨¡æ¿2ï¼ˆåŸºäºå…¶ä»–çˆ†æ¬¾æå–ï¼‰",
      "å¼€å¤´æ¨¡æ¿3"
    ],
    "emotionalTriggers": {
      "humor": ç™¾åˆ†æ¯”æ•°å­—,
      "pain": ç™¾åˆ†æ¯”æ•°å­—,
      "satisfaction": ç™¾åˆ†æ¯”æ•°å­—,
      "knowledge": ç™¾åˆ†æ¯”æ•°å­—
    },
    "contentFormats": {
      "monologue": ç™¾åˆ†æ¯”æ•°å­—,
      "drama": ç™¾åˆ†æ¯”æ•°å­—,
      "comparison": ç™¾åˆ†æ¯”æ•°å­—,
      "tutorial": ç™¾åˆ†æ¯”æ•°å­—
    }
  },
  "creativeGuide": {
    "trendingTopics": ["å½“å‰é€‚åˆçš„çƒ­ç‚¹è¯é¢˜1", "è¯é¢˜2"],
    "tagStrategy": [
      "#é«˜é¢‘æ ‡ç­¾1 + #é«˜é¢‘æ ‡ç­¾2 ç»„åˆä½¿ç”¨ï¼ˆè¯´æ˜äº’åŠ¨æ•ˆæœå¥½çš„åŸå› ï¼‰",
      "#å•ç‹¬ä½¿ç”¨æ ‡ç­¾3ï¼ˆè¯´æ˜åŸå› ï¼‰"
    ],
    "publishingTips": {
      "bestTime": "å»ºè®®å‘å¸ƒæ—¶æ®µï¼ˆåŸºäºå†å²æ•°æ®åˆ†æï¼‰",
      "frequency": "å»ºè®®å‘å¸ƒé¢‘ç‡"
    },
    "advice": [
      "å…·ä½“å¯æ‰§è¡Œçš„å»ºè®®1ï¼ˆä¸è¦ç”¨"å¯ä»¥è€ƒè™‘"ç­‰æ¨¡ç³Šè¡¨è¾¾ï¼‰",
      "å…·ä½“å¯æ‰§è¡Œçš„å»ºè®®2",
      "å…·ä½“å¯æ‰§è¡Œçš„å»ºè®®3"
    ]
  }
}

å…³é”®è¦æ±‚ï¼š
1. æ‰€æœ‰ç™¾åˆ†æ¯”æ•°å­—åŠ èµ·æ¥å¿…é¡»ç­‰äº100
2. é»„é‡‘3ç§’æ¨¡æ¿å¿…é¡»æ˜¯å¯ç›´æ¥å¥—ç”¨çš„å®Œæ•´å¥å­
3. å»ºè®®å¿…é¡»å…·ä½“å¯æ‰§è¡Œï¼Œä¸è¦æ¨¡ç³Šè¡¨è¾¾
4. å¦‚æœæŸäº›æ•°æ®ä¸è¶³ä»¥åˆ†æï¼Œè¯¥å­—æ®µå¡«nullæˆ–ç©ºæ•°ç»„
5. åªè¾“å‡ºJSONï¼Œä¸è¦æœ‰å…¶ä»–è§£é‡Šæ–‡å­—
```

### Tokené¢„ç®—ï¼ˆæ›´æ–°ï¼‰

- **è¾“å…¥ï¼š** ~3500 tokensï¼ˆå•†å®¶ä¿¡æ¯ + TOP10è¯¦ç»†å†…å®¹ + å¤æ‚ç»“æ„åŒ–è¦æ±‚ï¼‰
- **è¾“å‡ºï¼š** ~2000 tokensï¼ˆJSONæ ¼å¼å®Œæ•´æ¡£æ¡ˆï¼‰
- **æ€»è®¡ï¼š** ~5500 tokens/æ¬¡
- **æˆæœ¬ï¼š** Haiku $0.0015/æ¬¡ï¼ŒGemini Flash $0.0006/æ¬¡

**æˆæœ¬å¯¹æ¯”ï¼š**
- æ—§è®¾è®¡ï¼š~3700 tokensï¼Œ$0.001/æ¬¡
- æ–°è®¾è®¡ï¼š~5500 tokensï¼Œ$0.0015/æ¬¡
- **å¢åŠ ï¼š** 48%ï¼ˆä½†æä¾›çš„ä¿¡æ¯ä»·å€¼æå‡200%+ï¼‰

---

## å››ã€APIè®¾è®¡

### 1. GET /api/merchants/[id]/profile

**åŠŸèƒ½ï¼š** è·å–å•†å®¶æ¡£æ¡ˆï¼ˆå¦‚æœå­˜åœ¨ï¼‰

**æƒé™ï¼š** ç™»å½•ç”¨æˆ·

**å“åº”ï¼š**
```typescript
{
  success: true,
  data: {
    profile: MerchantProfile | null,
    merchant: {
      id: string,
      name: string,
      totalContentCount: number
    }
  }
}
```

**é”™è¯¯å¤„ç†ï¼š**
- 404ï¼šå•†å®¶ä¸å­˜åœ¨
- 403ï¼šæ— æƒé™è®¿é—®

---

### 2. POST /api/merchants/[id]/profile/generate

**åŠŸèƒ½ï¼š** ç”Ÿæˆæˆ–åˆ·æ–°AIæ¡£æ¡ˆéƒ¨åˆ†

**æƒé™ï¼š** ä»…ADMIN

**è¯·æ±‚ä½“ï¼š** æ— 

**å¤„ç†é€»è¾‘ï¼š**
1. æŸ¥è¯¢å•†å®¶åŸºæœ¬ä¿¡æ¯
2. è·å–TOP10çˆ†æ¬¾å†…å®¹ï¼ˆæŒ‰äº’åŠ¨è¯„åˆ†æ’åºï¼‰
3. æ„å»ºPrompt
4. è°ƒç”¨LLM APIï¼ˆHaikuæˆ–Gemini Flashï¼‰
5. è§£æAIå“åº”ï¼Œæå–å„éƒ¨åˆ†å†…å®¹
6. æ›´æ–°æˆ–åˆ›å»º MerchantProfile è®°å½•ï¼ˆåªæ›´æ–°AIå­—æ®µï¼‰
7. è¿”å›æ›´æ–°åçš„æ¡£æ¡ˆ

**å“åº”ï¼š**
```typescript
{
  success: true,
  data: {
    profile: MerchantProfile,
    tokensUsed: number,
    model: string
  }
}
```

**é”™è¯¯å¤„ç†ï¼š**
- 400ï¼šå•†å®¶å†…å®¹æ•°ä¸º0ï¼Œæ— æ³•ç”Ÿæˆ
- 500ï¼šAI APIè°ƒç”¨å¤±è´¥
- 503ï¼šTokené…é¢ä¸è¶³

---

### 3. PATCH /api/merchants/[id]/profile

**åŠŸèƒ½ï¼š** æ›´æ–°ç”¨æˆ·ç¼–è¾‘éƒ¨åˆ†

**æƒé™ï¼š** ä»…ADMIN

**è¯·æ±‚ä½“ï¼š**
```typescript
{
  customBackground?: string,     // å•†å®¶èƒŒæ™¯æ•…äº‹
  customOfflineInfo?: string,    // çº¿ä¸‹ä¿¡æ¯
  customProductDetails?: string, // äº§å“è¯¦ç»†ä¿¡æ¯ï¼ˆæ–°å¢ï¼‰
  customDosAndDonts?: string     // ç¦å¿Œæ¸…å•å’Œå¿…å¼ºè°ƒç‚¹ï¼ˆæ–°å¢ï¼‰
}
```

**å¤„ç†é€»è¾‘ï¼š**
1. éªŒè¯æƒé™
2. æŸ¥æ‰¾ç°æœ‰æ¡£æ¡ˆ
3. åªæ›´æ–° `custom*` å­—æ®µï¼Œä¸è§¦åŠ `ai*` å­—æ®µ
4. è¿”å›æ›´æ–°åçš„æ¡£æ¡ˆ

**å“åº”ï¼š**
```typescript
{
  success: true,
  data: {
    profile: MerchantProfile
  }
}
```

---

## äº”ã€å‰ç«¯ç»„ä»¶è®¾è®¡

### ç»„ä»¶ç»“æ„

```
components/merchants/
â”œâ”€â”€ merchant-profile-card.tsx      # ä¸»ç»„ä»¶ï¼ˆå®¹å™¨ï¼‰
â”œâ”€â”€ profile-ai-section.tsx         # AIç”Ÿæˆå†…å®¹å±•ç¤º
â”œâ”€â”€ profile-custom-section.tsx     # ç”¨æˆ·ç¼–è¾‘å†…å®¹å±•ç¤º
â””â”€â”€ profile-edit-dialog.tsx        # ç¼–è¾‘å¼¹çª—
```

### MerchantProfileCard ç»„ä»¶

**ä½ç½®ï¼š** `/merchants/[id]` é¡µé¢ï¼Œé¡µé¢å¤´éƒ¨ä¹‹å

**çŠ¶æ€æœºï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     æ¡£æ¡ˆä¸å­˜åœ¨ (profile = null)     â”‚
â”‚  [ç”Ÿæˆæ¡£æ¡ˆ] æŒ‰é’®                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“ ç‚¹å‡»ç”Ÿæˆ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ç”Ÿæˆä¸­ (generating = true)     â”‚
â”‚  [Loading...] é¢„è®¡10-15ç§’           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“ ç”Ÿæˆå®Œæˆ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     æ¡£æ¡ˆå­˜åœ¨ (é»˜è®¤å±•å¼€)             â”‚
â”‚  [â–²æ”¶èµ·] [ğŸ”„åˆ·æ–°] [âœï¸ç¼–è¾‘]           â”‚
â”‚  - AIåˆ†æéƒ¨åˆ†                       â”‚
â”‚  - ç”¨æˆ·è¡¥å……éƒ¨åˆ†                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Props:**
```typescript
interface MerchantProfileCardProps {
  merchantId: string
  merchantName: string
  isAdmin: boolean  // æ§åˆ¶ç¼–è¾‘æƒé™
}
```

**æ ¸å¿ƒé€»è¾‘ï¼š**
```typescript
const { data, isLoading, refetch } = useQuery({
  queryKey: ['merchant-profile', merchantId],
  queryFn: () => fetch(`/api/merchants/${merchantId}/profile`)
})

const generateMutation = useMutation({
  mutationFn: () => fetch(`/api/merchants/${merchantId}/profile/generate`, { method: 'POST' }),
  onSuccess: () => refetch()
})

const updateMutation = useMutation({
  mutationFn: (data) => fetch(`/api/merchants/${merchantId}/profile`, {
    method: 'PATCH',
    body: JSON.stringify(data)
  }),
  onSuccess: () => refetch()
})
```

---

### ProfileAISection ç»„ä»¶

**å±•ç¤ºAIç”Ÿæˆçš„5ä¸ªéƒ¨åˆ†ï¼š**

```tsx
<div className="space-y-4">
  <div>
    <h4 className="font-medium">å•†å®¶æ€»ç»“</h4>
    <p className="text-sm text-muted-foreground">{aiSummary}</p>
  </div>

  <div>
    <h4 className="font-medium">çˆ†æ¬¾å†…å®¹ç‰¹å¾</h4>
    <p className="text-sm text-muted-foreground">{aiTopContent}</p>
  </div>

  <div>
    <h4 className="font-medium">å—ä¼—åå¥½</h4>
    <p className="text-sm text-muted-foreground">{aiAudienceProfile}</p>
  </div>

  <div>
    <h4 className="font-medium">çƒ­é—¨æ ‡ç­¾è¶‹åŠ¿</h4>
    <div className="flex flex-wrap gap-2">
      {tags.map(tag => <Badge key={tag}>{tag}</Badge>)}
    </div>
  </div>

  <div>
    <h4 className="font-medium">åˆ›ä½œå»ºè®®</h4>
    <ul className="list-disc list-inside text-sm text-muted-foreground">
      {strategies.map(s => <li key={s}>{s}</li>)}
    </ul>
  </div>

  <div className="text-xs text-muted-foreground">
    ç”Ÿæˆäºï¼š{aiGeneratedAt} | æ¨¡å‹ï¼š{aiModelUsed} | æ¶ˆè€—ï¼š{aiTokenUsed} tokens
  </div>
</div>
```

---

### ProfileCustomSection ç»„ä»¶

**å±•ç¤ºç”¨æˆ·ç¼–è¾‘çš„4ä¸ªéƒ¨åˆ†ï¼ˆæ›´æ–°ï¼‰ï¼š**

```tsx
<div className="space-y-3">
  <InfoRow label="å•†å®¶èƒŒæ™¯æ•…äº‹" value={customBackground} />
  <InfoRow label="çº¿ä¸‹ä¿¡æ¯" value={customOfflineInfo} />
  <InfoRow label="äº§å“è¯¦ç»†ä¿¡æ¯" value={customProductDetails} />
  <InfoRow label="ç¦å¿Œä¸å¿…å¼ºè°ƒç‚¹" value={customDosAndDonts} />
</div>
```

**å¦‚æœæ‰€æœ‰å­—æ®µä¸ºç©ºï¼š**
```tsx
<div className="text-sm text-muted-foreground">
  æš‚æ— äººå·¥è¡¥å……ä¿¡æ¯ã€‚ç‚¹å‡»[ç¼–è¾‘]æŒ‰é’®æ·»åŠ ã€‚
</div>
```

---

### ProfileEditDialog ç»„ä»¶

**å¯¹è¯æ¡†è¡¨å•ï¼š**

```tsx
<Dialog>
  <DialogContent>
    <DialogHeader>
      <DialogTitle>ç¼–è¾‘åˆ›ä½œæ¡£æ¡ˆ</DialogTitle>
      <DialogDescription>
        ä»…ç¼–è¾‘äººå·¥è¡¥å……éƒ¨åˆ†ï¼ŒAIåˆ†æéƒ¨åˆ†è¯·ç‚¹å‡»"åˆ·æ–°æ¡£æ¡ˆ"é‡æ–°ç”Ÿæˆã€‚
      </DialogDescription>
    </DialogHeader>

    <div className="space-y-4">
      <div>
        <Label>å•†å®¶èƒŒæ™¯æ•…äº‹</Label>
        <Textarea
          value={customBackground}
          onChange={...}
          placeholder="è€æ¿æ˜¯è°ã€åˆ›ä¸šæ•…äº‹ã€å“ç‰Œå†å²ç­‰..."
        />
      </div>

      <div>
        <Label>çº¿ä¸‹ä¿¡æ¯</Label>
        <Textarea
          value={customOfflineInfo}
          onChange={...}
          placeholder="å®ä½“åº—ä½ç½®ã€åº—é¢ç‰¹ç‚¹ã€åœ°ç†ä¼˜åŠ¿ç­‰..."
        />
      </div>

      <div>
        <Label>äº§å“è¯¦ç»†ä¿¡æ¯</Label>
        <Textarea
          value={customProductDetails}
          onChange={...}
          placeholder="äº§å“è§„æ ¼ã€ä½¿ç”¨æ–¹æ³•ã€ç‹¬ç‰¹å·¥è‰ºç­‰AIä¸çŸ¥é“çš„ç»†èŠ‚..."
        />
      </div>

      <div>
        <Label>ç¦å¿Œä¸å¿…å¼ºè°ƒç‚¹</Label>
        <Textarea
          value={customDosAndDonts}
          onChange={...}
          placeholder="ç¦å¿Œè¯æ±‡ã€ä¸èƒ½æåŠçš„ç«å“ã€å¿…é¡»å¼ºè°ƒçš„å–ç‚¹ç­‰..."
        />
      </div>
    </div>

    <DialogFooter>
      <Button variant="outline" onClick={onClose}>å–æ¶ˆ</Button>
      <Button onClick={handleSave}>ä¿å­˜</Button>
    </DialogFooter>
  </DialogContent>
</Dialog>
```

---

## å…­ã€å®ç°æ­¥éª¤

### Phase 1ï¼šæ•°æ®åº“å’Œç±»å‹ï¼ˆ45åˆ†é’Ÿï¼Œå¢åŠ 15åˆ†é’Ÿï¼‰

1. **ä¿®æ”¹ `prisma/schema.prisma`**
   - æ·»åŠ  `MerchantProfile` modelï¼ˆ13ä¸ªAIå­—æ®µ + 4ä¸ªç”¨æˆ·å­—æ®µï¼‰
   - åœ¨ `Merchant` ä¸­æ·»åŠ  `profile` å…³ç³»

2. **è¿è¡Œè¿ç§»**
   ```bash
   pnpm db:generate
   pnpm db:push
   ```

3. **æ›´æ–°ç±»å‹å®šä¹‰ `types/merchant.ts`**ï¼ˆå­—æ®µæ•°é‡ä»9ä¸ªå¢åŠ åˆ°17ä¸ªï¼‰
   ```typescript
   export interface MerchantProfile {
     id: string
     merchantId: string
   
     // PART 1: å•†å®¶Brief
     briefIntro?: string
     briefSellingPoints?: string          // JSONæ•°ç»„
     briefUsageScenarios?: string         // JSONæ•°ç»„
     briefAudienceProfile?: string        // JSONå¯¹è±¡
     briefBrandTone?: string
   
     // PART 2: çˆ†æ¬¾åˆ†æ
     topContentAnalysis?: string          // JSONæ•°ç»„
     goldenThreeSeconds?: string          // JSONæ•°ç»„
     emotionalTriggers?: string           // JSONå¯¹è±¡ï¼ˆç™¾åˆ†æ¯”ï¼‰
     contentFormats?: string              // JSONå¯¹è±¡ï¼ˆç™¾åˆ†æ¯”ï¼‰
   
     // PART 3: åˆ›ä½œæŒ‡å—
     trendingTopics?: string              // JSONæ•°ç»„
     tagStrategy?: string                 // JSONæ•°ç»„
     publishingTips?: string              // JSONå¯¹è±¡
     creativeAdvice?: string              // JSONæ•°ç»„
   
     // å…ƒæ•°æ®
     aiGeneratedAt?: string
     aiModelUsed?: string
     aiTokenUsed: number
   
     // ç”¨æˆ·ç¼–è¾‘éƒ¨åˆ†
     customBackground?: string
     customOfflineInfo?: string
     customProductDetails?: string
     customDosAndDonts?: string
   
     createdAt: string
     updatedAt: string
   }
   
   // è¾…åŠ©ç±»å‹ï¼ˆç”¨äºJSONè§£æï¼‰
   export interface ProfileBrief {
     intro: string
     sellingPoints: string[]
     usageScenarios: string[]
     audienceProfile: {
       age: string
       gender: string
       interests: string[]
       behaviors: string
     }
     brandTone: string
   }
   
   export interface ProfileViralAnalysis {
     topContents: Array<{
       rank: number
       title: string
       opening: string
       emotionType: string
       format: string
       engagement: number
     }>
     goldenThreeSeconds: string[]
     emotionalTriggers: Record<string, number>
     contentFormats: Record<string, number>
   }
   
   export interface ProfileCreativeGuide {
     trendingTopics: string[]
     tagStrategy: string[]
     publishingTips: {
       bestTime: string
       frequency: string
     }
     advice: string[]
   }
   ```

---

### Phase 2ï¼šAIç”Ÿæˆé€»è¾‘ï¼ˆ90åˆ†é’Ÿï¼Œå¢åŠ 30åˆ†é’Ÿï¼‰

1. **åˆ›å»º `lib/ai/profile-generator.ts`**
   - `generateMerchantProfile(merchantId: string)` å‡½æ•°
   - æ•°æ®æŸ¥è¯¢ï¼ˆå•†å®¶ä¿¡æ¯ + TOP10å†…å®¹ï¼‰
   - Promptæ„å»ºï¼ˆJSONæ ¼å¼ï¼Œæ›´å¤æ‚ï¼‰
   - LLMè°ƒç”¨ï¼ˆä½¿ç”¨ç°æœ‰çš„ `lib/ai/key-manager.ts`ï¼‰
   - å“åº”è§£æï¼ˆJSONè§£æï¼Œ13ä¸ªå­—æ®µï¼‰

2. **åˆ›å»º `lib/ai/profile-parser.ts`**
   - è§£æAIå“åº”çš„JSONæ–‡æœ¬
   - éªŒè¯JSONç»“æ„ï¼ˆbriefã€viralAnalysisã€creativeGuideä¸‰å¤§éƒ¨åˆ†ï¼‰
   - æå–å¹¶æ ¼å¼åŒ–å„ä¸ªå­—æ®µ
   - é”™è¯¯å¤„ç†ï¼ˆJSONè§£æå¤±è´¥æ—¶çš„é™çº§ç­–ç•¥ï¼‰
   - è¿”å›ç»“æ„åŒ–æ•°æ®

**æ ¸å¿ƒä»£ç ç¤ºä¾‹ï¼š**
```typescript
export async function generateMerchantProfile(merchantId: string) {
  // 1. è·å–å•†å®¶å’ŒTOP10å†…å®¹
  const merchant = await prisma.merchant.findUnique({
    where: { id: merchantId },
    include: {
      category: true,
      contents: {
        orderBy: { /* äº’åŠ¨è¯„åˆ† */ },
        take: 10
      }
    }
  })

  // 2. æ„å»ºPrompt
  const prompt = buildProfilePrompt(merchant)

  // 3. è°ƒç”¨LLM
  const response = await fetch(LLM_API_BASE + '/chat/completions', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${apiKey}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      model: 'claude-3-5-haiku-20241022',
      messages: [
        { role: 'system', content: SYSTEM_PROMPT },
        { role: 'user', content: prompt }
      ],
      max_tokens: 2000
    })
  })

  // 4. è§£æå“åº”
  const completion = await response.json()
  const parsed = parseProfileResponse(completion.choices[0].message.content)

  // 5. ä¿å­˜åˆ°æ•°æ®åº“
  const profile = await prisma.merchantProfile.upsert({
    where: { merchantId },
    create: {
      merchantId,
      ...parsed,
      aiGeneratedAt: new Date(),
      aiModelUsed: 'claude-3-5-haiku-20241022',
      aiTokenUsed: completion.usage.total_tokens
    },
    update: {
      ...parsed,
      aiGeneratedAt: new Date(),
      aiModelUsed: 'claude-3-5-haiku-20241022',
      aiTokenUsed: completion.usage.total_tokens
      // æ³¨æ„ï¼šä¸æ›´æ–° custom* å­—æ®µ
    }
  })

  return profile
}
```

---

### Phase 3ï¼šAPIè·¯ç”±ï¼ˆ45åˆ†é’Ÿï¼‰

1. **åˆ›å»º `app/api/merchants/[id]/profile/route.ts`**
   - GET å¤„ç†å™¨ï¼šè¿”å›ç°æœ‰æ¡£æ¡ˆ
   - PATCH å¤„ç†å™¨ï¼šæ›´æ–°ç”¨æˆ·å­—æ®µ

2. **åˆ›å»º `app/api/merchants/[id]/profile/generate/route.ts`**
   - POST å¤„ç†å™¨ï¼šè§¦å‘AIç”Ÿæˆ

**ç¤ºä¾‹ä»£ç ï¼š**
```typescript
// app/api/merchants/[id]/profile/route.ts
export async function GET(req: Request, { params }: { params: { id: string } }) {
  const profile = await prisma.merchantProfile.findUnique({
    where: { merchantId: params.id },
    include: { merchant: { select: { id: true, name: true, totalContentCount: true } } }
  })

  return apiSuccess({ profile })
}

export async function PATCH(req: Request, { params }: { params: { id: string } }) {
  const session = await getServerSession(authOptions)
  if (session?.user?.role !== 'ADMIN') {
    return apiError('æ— æƒé™', 403)
  }

  const body = await req.json()
  const profile = await prisma.merchantProfile.upsert({
    where: { merchantId: params.id },
    create: {
      merchantId: params.id,
      customBackground: body.customBackground,
      customOfflineInfo: body.customOfflineInfo,
      customProductDetails: body.customProductDetails,
      customDosAndDonts: body.customDosAndDonts
    },
    update: {
      customBackground: body.customBackground,
      customOfflineInfo: body.customOfflineInfo,
      customProductDetails: body.customProductDetails,
      customDosAndDonts: body.customDosAndDonts
      // ä¸æ›´æ–° ai* å­—æ®µï¼ˆ13ä¸ªå­—æ®µä¿æŒä¸å˜ï¼‰
    }
  })

  return apiSuccess({ profile })
}
```

---

### Phase 4ï¼šå‰ç«¯ç»„ä»¶ï¼ˆ120åˆ†é’Ÿï¼Œå¢åŠ 30åˆ†é’Ÿï¼‰

1. **åˆ›å»º React Query Hooks** (`hooks/api/use-merchant-profile.ts`)
   - `useMerchantProfile(merchantId)`
   - `useGenerateProfile(merchantId)`
   - `useUpdateProfile(merchantId)`
   - å¤„ç†å¤æ‚çš„JSONå­—æ®µè§£æ

2. **åˆ›å»ºUIç»„ä»¶**ï¼ˆéœ€è¦å±•ç¤º13ä¸ªAIå­—æ®µï¼‰
   - `components/merchants/merchant-profile-card.tsx` - ä¸»å®¹å™¨ï¼ŒçŠ¶æ€ç®¡ç†
   - `components/merchants/profile-ai-section.tsx` - å±•ç¤º3ä¸ªéƒ¨åˆ†ï¼ˆBriefã€çˆ†æ¬¾åˆ†æã€åˆ›ä½œæŒ‡å—ï¼‰
   - `components/merchants/profile-custom-section.tsx` - å±•ç¤º4ä¸ªç”¨æˆ·å­—æ®µ
   - `components/merchants/profile-edit-dialog.tsx` - ç¼–è¾‘4ä¸ªç”¨æˆ·å­—æ®µ

3. **é›†æˆåˆ°å•†å®¶è¯¦æƒ…é¡µ**
   - ä¿®æ”¹ `app/merchants/[id]/page.tsx`
   - åœ¨é¡µé¢å¤´éƒ¨åæ’å…¥ `<MerchantProfileCard />`

---

### Phase 5ï¼šæµ‹è¯•å’Œä¼˜åŒ–ï¼ˆ60åˆ†é’Ÿï¼Œå¢åŠ 15åˆ†é’Ÿï¼‰

1. **æ‰‹åŠ¨æµ‹è¯•æµç¨‹**
   - ä¸ºæ²¡æœ‰æ¡£æ¡ˆçš„å•†å®¶ç”Ÿæˆæ¡£æ¡ˆ
   - åˆ·æ–°æ¡£æ¡ˆï¼ˆéªŒè¯AIå­—æ®µæ›´æ–°ï¼Œç”¨æˆ·å­—æ®µä¿ç•™ï¼‰
   - ç¼–è¾‘ç”¨æˆ·å­—æ®µ
   - æµ‹è¯•æƒé™æ§åˆ¶ï¼ˆéADMINä¸èƒ½ç¼–è¾‘ï¼‰

2. **é”™è¯¯å¤„ç†æµ‹è¯•**
   - å†…å®¹æ•°ä¸º0çš„å•†å®¶
   - APIè°ƒç”¨å¤±è´¥
   - Tokené…é¢ä¸è¶³

3. **æ€§èƒ½ä¼˜åŒ–**
   - React Queryç¼“å­˜é…ç½®
   - LoadingçŠ¶æ€ä¼˜åŒ–
   - é”™è¯¯æç¤ºä¼˜åŒ–

---

## ä¸ƒã€æ½œåœ¨é£é™©å’Œç¼“è§£æªæ–½

### é£é™©1ï¼šAIç”Ÿæˆè´¨é‡ä¸ç¨³å®š

**é—®é¢˜ï¼š** AIå¯èƒ½ç”Ÿæˆæ ¼å¼ä¸ç¬¦åˆé¢„æœŸçš„å†…å®¹

**ç¼“è§£ï¼š**
- ä½¿ç”¨ä¸¥æ ¼çš„Promptçº¦æŸï¼ˆå­—æ•°é™åˆ¶ã€æ ¼å¼è¦æ±‚ï¼‰
- æ·»åŠ å“åº”è§£æçš„å®¹é”™é€»è¾‘
- å¦‚æœè§£æå¤±è´¥ï¼Œä¿å­˜åŸå§‹æ–‡æœ¬ï¼Œå‰ç«¯ä¼˜é›…é™çº§æ˜¾ç¤º

---

### é£é™©2ï¼šTokenæˆæœ¬å¤±æ§

**é—®é¢˜ï¼š** ç”¨æˆ·é¢‘ç¹åˆ·æ–°å¯¼è‡´æˆæœ¬æ¿€å¢

**ç¼“è§£ï¼š**
- å‰ç«¯æ˜¾ç¤º"ä¸Šæ¬¡ç”Ÿæˆæ—¶é—´"ï¼Œå‡å°‘æ— æ„ä¹‰åˆ·æ–°
- æ·»åŠ åˆ·æ–°é¢‘ç‡é™åˆ¶ï¼ˆä¾‹å¦‚ï¼š10åˆ†é’Ÿå†…åªèƒ½åˆ·æ–°1æ¬¡ï¼‰
- ä½¿ç”¨ä¾¿å®œçš„æ¨¡å‹ï¼ˆHaiku/Gemini Flashï¼‰
- ç›‘æ§å•æ—¥tokenæ¶ˆè€—ï¼Œè®¾ç½®å‘Šè­¦é˜ˆå€¼

---

### é£é™©3ï¼šæ•°æ®ä¸è¶³æ— æ³•ç”Ÿæˆæœ‰æ•ˆåˆ†æ

**é—®é¢˜ï¼š** æ–°å•†å®¶æˆ–å†…å®¹æ•°<5æ—¶ï¼ŒAIåˆ†æä»·å€¼æœ‰é™

**ç¼“è§£ï¼š**
- å‰ç«¯æ£€æŸ¥ `totalContentCount`ï¼Œå¦‚æœ<5åˆ™è­¦å‘Šç”¨æˆ·
- Promptä¸­æ˜ç¡®æŒ‡ç¤º"å¦‚æœæ•°æ®ä¸è¶³ï¼Œè¯´æ˜æƒ…å†µ"
- ç”¨æˆ·å­—æ®µä»ç„¶å¯ç”¨ï¼Œå¯æ‰‹åŠ¨è¡¥å……ä¿¡æ¯

---

### é£é™©4ï¼šåˆ·æ–°æ—¶è¯¯è¦†ç›–ç”¨æˆ·ç¼–è¾‘å†…å®¹

**é—®é¢˜ï¼š** è™½ç„¶è®¾è®¡ä¸Šåˆ†ç¦»ï¼Œä½†ä»£ç bugå¯èƒ½å¯¼è‡´è¯¯è¦†ç›–

**ç¼“è§£ï¼š**
- **æ•°æ®åº“å±‚ä¿æŠ¤ï¼š** PATCHåªæ›´æ–° `custom*` å­—æ®µï¼ŒPOSTåªæ›´æ–° `ai*` å­—æ®µ
- **ä»£ç Reviewé‡ç‚¹æ£€æŸ¥ï¼š** upsertè¯­å¥çš„å­—æ®µåˆ—è¡¨
- **æµ‹è¯•ç”¨ä¾‹ï¼š** éªŒè¯åˆ·æ–°åç”¨æˆ·å­—æ®µä¸å˜

---

## å…«ã€æˆåŠŸæ ‡å‡†

åŠŸèƒ½å®Œæˆåï¼Œåº”è¯¥æ»¡è¶³ï¼š

âœ… **åŠŸèƒ½å®Œæ•´æ€§**
- [ ] å¯ä»¥ä¸ºå•†å®¶ç”ŸæˆAIæ¡£æ¡ˆ
- [ ] å¯ä»¥åˆ·æ–°AIæ¡£æ¡ˆï¼ˆä¸è¦†ç›–ç”¨æˆ·å­—æ®µï¼‰
- [ ] å¯ä»¥ç¼–è¾‘ç”¨æˆ·å­—æ®µï¼ˆä¸è§¦å‘AIç”Ÿæˆï¼‰
- [ ] æ¡£æ¡ˆåœ¨å•†å®¶è¯¦æƒ…é¡µæ­£ç¡®æ˜¾ç¤º

âœ… **æ•°æ®æ­£ç¡®æ€§**
- [ ] AIå­—æ®µå’Œç”¨æˆ·å­—æ®µç‰©ç†åˆ†ç¦»
- [ ] åˆ·æ–°æ—¶åªæ›´æ–°AIå­—æ®µ
- [ ] ç¼–è¾‘æ—¶åªæ›´æ–°ç”¨æˆ·å­—æ®µ
- [ ] çº§è”åˆ é™¤æ­£å¸¸å·¥ä½œ

âœ… **æ€§èƒ½å’Œæˆæœ¬**
- [ ] å•æ¬¡ç”Ÿæˆè€—æ—¶<15ç§’
- [ ] å•æ¬¡ç”Ÿæˆæˆæœ¬<$0.002
- [ ] React Queryç¼“å­˜æ­£å¸¸å·¥ä½œ
- [ ] æ— ä¸å¿…è¦çš„APIè°ƒç”¨

âœ… **ç”¨æˆ·ä½“éªŒ**
- [ ] LoadingçŠ¶æ€æ¸…æ™°
- [ ] é”™è¯¯æç¤ºå‹å¥½
- [ ] æƒé™æ§åˆ¶æ­£ç¡®ï¼ˆéADMINä¸èƒ½ç¼–è¾‘ï¼‰
- [ ] ç§»åŠ¨ç«¯æ˜¾ç¤ºæ­£å¸¸

---

## ä¹ã€åç»­ä¼˜åŒ–æ–¹å‘ï¼ˆV2åŠŸèƒ½ï¼Œä¸åœ¨æœ¬æ¬¡å®æ–½èŒƒå›´ï¼‰

1. **å¯¼å‡ºåŠŸèƒ½**ï¼šå°†æ¡£æ¡ˆå¯¼å‡ºä¸ºPDF/Wordï¼Œä¾›çº¿ä¸‹ä½¿ç”¨
2. **ç‰ˆæœ¬å†å²**ï¼šè®°å½•æ¡£æ¡ˆçš„å†å²ç‰ˆæœ¬ï¼ˆå¦‚æœæœ‰éœ€æ±‚ï¼‰
3. **æ‰¹é‡ç”Ÿæˆ**ï¼šä¸ºæ‰€æœ‰å•†å®¶æ‰¹é‡ç”Ÿæˆæ¡£æ¡ˆ
4. **å®šæ—¶åˆ·æ–°**ï¼šè®¾ç½®å®šæ—¶ä»»åŠ¡ï¼Œè‡ªåŠ¨åˆ·æ–°æ¡£æ¡ˆ
5. **å¤šè¯­è¨€æ”¯æŒ**ï¼šç”Ÿæˆè‹±æ–‡ç‰ˆæ¡£æ¡ˆ

---

## åã€æ—¶é—´ä¼°ç®—

### æœ€ç»ˆæ—¶é—´ä¼°ç®—ï¿½ï¿½åŸºäºç¬¬å››è½®å¯¹é½ï¼‰

| é˜¶æ®µ | æ—§æ—¶é—´ | æ–°æ—¶é—´ | å¢åŠ  | è¯´æ˜ |
|------|--------|--------|------|------|
| Phase 1: æ•°æ®åº“å’Œç±»å‹ | 30min | **45min** | +15min | å­—æ®µä»9ä¸ªå¢è‡³17ä¸ªï¼Œæ–°å¢è¾…åŠ©ç±»å‹ |
| Phase 2: AIç”Ÿæˆé€»è¾‘ | 60min | **90min** | +30min | JSONæ ¼å¼Promptæ›´å¤æ‚ï¼Œ13ä¸ªå­—æ®µè§£æ |
| Phase 3: APIè·¯ç”± | 45min | **45min** | - | æ— å˜åŒ– |
| Phase 4: å‰ç«¯ç»„ä»¶ | 90min | **120min** | +30min | éœ€å±•ç¤º13ä¸ªAIå­—æ®µï¼Œ3ä¸ªéƒ¨åˆ† |
| Phase 5: æµ‹è¯•å’Œä¼˜åŒ– | 45min | **60min** | +15min | æ›´å¤šå­—æ®µéœ€è¦æµ‹è¯•éªŒè¯ |
| **æ€»è®¡** | **4.5å°æ—¶** | **6å°æ—¶** | **+1.5å°æ—¶** | çº¯ç¼–ç æ—¶é—´ï¼ˆä¸å«éœ€æ±‚è®¨è®ºï¼‰ |

### æ—¶é—´å¢åŠ åŸå› 
- **æ•°æ®ç»“æ„å¤æ‚åŒ–**ï¼šä»5ä¸ªAIå­—æ®µå¢è‡³13ä¸ªï¼Œä¿¡æ¯ä»·å€¼æå‡200%+
- **JSONè§£æå’ŒéªŒè¯**ï¼šéœ€è¦å¤„ç†åµŒå¥—çš„JSONç»“æ„
- **UIå±•ç¤ºé€»è¾‘**ï¼šéœ€è¦å°†JSONæ•°æ®æ ¼å¼åŒ–å±•ç¤ºï¼ˆå¦‚é»„é‡‘3ç§’æ¨¡æ¿ã€ç™¾åˆ†æ¯”å›¾è¡¨ï¼‰
- **æµ‹è¯•è¦†ç›–é¢**ï¼šæ›´å¤šå­—æ®µæ„å‘³ç€æ›´å¤šæµ‹è¯•åœºæ™¯

### ä»·å€¼æ”¶ç›Š
è™½ç„¶æ—¶é—´å¢åŠ 33%ï¼Œä½†æä¾›çš„ä¿¡æ¯ä»·å€¼æå‡200%+ï¼š
- æ—§æ–¹æ¡ˆï¼šæ³›æ³›çš„åˆ†æï¼Œåˆ›ä½œè€…ä»éœ€è‡ªå·±æç‚¼
- æ–°æ–¹æ¡ˆï¼šå¯ç›´æ¥å¥—ç”¨çš„Brief + é»„é‡‘3ç§’æ¨¡æ¿ + å…·ä½“å»ºè®®

---

## åä¸€ã€å…³é”®ä»£ç æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶
- `lib/ai/profile-generator.ts` - AIç”Ÿæˆæ ¸å¿ƒé€»è¾‘
- `lib/ai/profile-parser.ts` - å“åº”è§£æ
- `app/api/merchants/[id]/profile/route.ts` - GET/PATCH
- `app/api/merchants/[id]/profile/generate/route.ts` - POST
- `hooks/api/use-merchant-profile.ts` - React Query Hooks
- `components/merchants/merchant-profile-card.tsx` - ä¸»å®¹å™¨
- `components/merchants/profile-ai-section.tsx` - AIå†…å®¹å±•ç¤º
- `components/merchants/profile-custom-section.tsx` - ç”¨æˆ·å†…å®¹å±•ç¤º
- `components/merchants/profile-edit-dialog.tsx` - ç¼–è¾‘å¯¹è¯æ¡†

### ä¿®æ”¹æ–‡ä»¶
- `prisma/schema.prisma` - æ·»åŠ MerchantProfile model
- `types/merchant.ts` - æ·»åŠ MerchantProfileç±»å‹
- `app/merchants/[id]/page.tsx` - é›†æˆæ¡£æ¡ˆå¡ç‰‡

---

## åäºŒã€æ£€æŸ¥æ¸…å•ï¼ˆå®æ–½å‰ç¡®è®¤ï¼‰

åœ¨å¼€å§‹ç¼–ç å‰ï¼Œè¯·ç¡®è®¤ï¼š

- [x] éœ€æ±‚å·²å……åˆ†å¯¹é½ï¼ˆ**å››è½®å¯¹é½å®Œæˆï¼ŒåŸºäº2025å¹´æŠ–éŸ³åˆ›ä½œçœŸå®éœ€æ±‚**ï¼‰
- [x] æ•°æ®åº“è®¾è®¡å·²ç¡®è®¤ï¼ˆMerchantProfile schema - 13ä¸ªAIå­—æ®µ + 4ä¸ªç”¨æˆ·å­—æ®µï¼‰
- [x] AIæ¨¡å‹å·²é€‰å®šï¼ˆClaude Haiku æˆ– Gemini Flashï¼‰
- [x] APIè®¾è®¡å·²ç¡®è®¤ï¼ˆ3ä¸ªç«¯ç‚¹ï¼šGET/POST/PATCHï¼‰
- [x] UIäº¤äº’å·²ç¡®è®¤ï¼ˆæŠ˜å å¡ç‰‡ + ç¼–è¾‘å¯¹è¯æ¡†ï¼‰
- [x] æƒé™æ§åˆ¶å·²æ˜ç¡®ï¼ˆä»…ADMINå¯ç¼–è¾‘å’Œç”Ÿæˆï¼‰
- [x] Tokenæˆæœ¬å¯æ¥å—ï¼ˆ**~$0.0015/æ¬¡ï¼Œå¢åŠ 50%ä½†ä»·å€¼æå‡200%+**ï¼‰
- [x] å®æ–½æ–¹æ¡ˆå·²è°ƒç ”éªŒè¯ï¼ˆåŸºäºæŠ–éŸ³æ–‡æ¡ˆåˆ›ä½œBriefæ ¼å¼ï¼‰
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½®ï¼ˆLLM_API_KEYç­‰ï¼‰
- [ ] æ—¶é—´é¢„ç®—å·²æ‰¹å‡†ï¼ˆ**6å°æ—¶ï¼Œæ¯”åˆç‰ˆå¢åŠ 1.5å°æ—¶**ï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v2.0ï¼ˆç¬¬å››è½®å¯¹é½åæ›´æ–°ï¼‰
**åˆ›å»ºæ—¶é—´ï¼š** 2025-11-03
**æœ€åæ›´æ–°ï¼š** 2025-11-03ï¼ˆåŸºäºçœŸå®åˆ›ä½œéœ€æ±‚é‡æ–°è®¾è®¡ï¼‰
**ä½œè€…ï¼š** å»–æ™¯æ¶›
**å®¡æ ¸çŠ¶æ€ï¼š** âœ… ç”¨æˆ·å·²ç¡®è®¤ï¼Œå‡†å¤‡å®æ–½
