# TikHub API çƒ­é—¨è´¦å·æµ‹è¯•å·¥å…·

## åŠŸèƒ½è¯´æ˜

è¿™ä¸ªæµ‹è¯•å·¥å…·ç”¨äºæµ‹è¯• TikHub API çš„çƒ­é—¨è´¦å·æ¥å£ï¼Œè·å–æŠ–éŸ³å„å‚ç±»çš„çƒ­é—¨è´¦å·æ’è¡Œæ¦œã€‚

### API ä¿¡æ¯
- **ç«¯ç‚¹**: `/api/v1/douyin/billboard/fetch_hot_account_list`
- **æ–¹æ³•**: POST
- **è®¤è¯**: Bearer Token (ä½¿ç”¨ `TIKHUB_API_KEY`)
- **å‚æ•°**:
  - `date_window`: æ—¶é—´çª—å£ï¼ˆå°æ—¶ï¼‰ï¼Œé»˜è®¤24å°æ—¶
  - `page_num`: é¡µç ï¼Œé»˜è®¤1
  - `page_size`: æ¯é¡µæ•°é‡ï¼Œé»˜è®¤10
  - `query_tag`: å‚ç±»æ ‡ç­¾ç­›é€‰ï¼Œç©ºå¯¹è±¡è¡¨ç¤ºå…¨éƒ¨å‚ç±»
- **è¿”å›**: çƒ­é—¨è´¦å·åˆ—è¡¨ï¼ˆæŒ‰çƒ­åº¦æ’åºï¼‰

## ä½¿ç”¨æ–¹æ³•

### 1. åŸºæœ¬ä½¿ç”¨ - è·å–å…¨éƒ¨å‚ç±»çƒ­é—¨è´¦å·

```bash
npx tsx scripts/test-hot-accounts.ts
```

**è¾“å‡ºå†…å®¹åŒ…æ‹¬**:
- è´¦å·æ˜µç§°
- ç²‰ä¸æ•°ï¼ˆä¸‡/åƒä¸‡æ ¼å¼åŒ–ï¼‰
- è·èµæ•°ï¼ˆä¸‡/äº¿æ ¼å¼åŒ–ï¼‰
- ä½œå“æ•°é‡
- è´¦å·UIDï¼ˆsec_uidï¼‰
- å®Œæ•´æ•°æ®å¯¼å‡ºåˆ° `hot-accounts-output.json` æ–‡ä»¶

### 2. è·å–ç‰¹å®šå‚ç±»çš„çƒ­é—¨è´¦å·

```bash
# ç¾é£Ÿå‚ç±»
npx tsx scripts/test-hot-accounts.ts --tag=628

# æ—…è¡Œå‚ç±»
npx tsx scripts/test-hot-accounts.ts --tag=629

# æ•™è‚²æ ¡å›­å‚ç±»
npx tsx scripts/test-hot-accounts.ts --tag=626
```

**è¾“å‡ºå†…å®¹åŒ…æ‹¬**:
- è¯¥å‚ç±»çš„çƒ­é—¨è´¦å·åˆ—è¡¨
- è‡ªåŠ¨æ˜¾ç¤ºå‚ç±»åç§°ï¼ˆå¦‚"ç¾é£Ÿ"ï¼‰
- å®Œæ•´æ•°æ®ä¿å­˜åˆ° `hot-accounts-{tagId}-output.json`

### 3. è‡ªå®šä¹‰å‚æ•°

```bash
# æŸ¥è¯¢48å°æ—¶çª—å£å†…çš„æ•°æ®ï¼Œæ¯é¡µ20æ¡
npx tsx scripts/test-hot-accounts.ts --hours=48 --size=20

# ç¾é£Ÿå‚ç±»ï¼Œ24å°æ—¶çª—å£ï¼Œ5æ¡æ•°æ®
npx tsx scripts/test-hot-accounts.ts --tag=628 --hours=24 --size=5
```

## è¯·æ±‚å‚æ•°ç»“æ„

### å…¨éƒ¨å‚ç±»æŸ¥è¯¢
```json
{
  "date_window": 24,
  "page_num": 1,
  "page_size": 10,
  "query_tag": {}
}
```

### å•ä¸ªå‚ç±»æŸ¥è¯¢ï¼ˆå¦‚ç¾é£Ÿï¼‰
```json
{
  "date_window": 24,
  "page_num": 1,
  "page_size": 10,
  "query_tag": {
    "value": 628
  }
}
```

### å‚ç±»+å­å‚ç±»æŸ¥è¯¢
```json
{
  "date_window": 24,
  "page_num": 1,
  "page_size": 10,
  "query_tag": {
    "value": 628,
    "children": [
      { "value": 62804 }
    ]
  }
}
```

## å“åº”æ•°æ®ç»“æ„

### è´¦å·å¯¹è±¡
```typescript
interface HotAccountInfo {
  user_id: string          // è´¦å·å®‰å…¨ID (sec_uid)
  nick_name: string        // æ˜µç§°
  avatar_url?: string      // å¤´åƒURL
  fans_cnt: number         // ç²‰ä¸æ•°
  like_cnt: number         // æ€»è·èµæ•°
  publish_cnt: number      // ä½œå“æ•°
  new_like_cnt?: number    // æ–°å¢è·èµæ•°
  new_fans_cnt?: number    // æ–°å¢ç²‰ä¸æ•°
  second_tag_name?: string // äºŒçº§æ ‡ç­¾åç§°
  fans_trends?: Array<{    // ç²‰ä¸è¶‹åŠ¿
    DateTime: string
    Value: number
  }>
  fans_incr_rate?: number  // ç²‰ä¸å¢é•¿ç‡
}
```

### ç¤ºä¾‹å“åº”
```json
{
  "code": 0,
  "data": {
    "user_list": [
      {
        "user_id": "MS4wLjABAAAA...",
        "nick_name": "äººæ°‘æ—¥æŠ¥",
        "fans_cnt": 196253684,
        "like_cnt": 16592718141,
        "publish_cnt": 11415
      }
    ],
    "has_more": true
  }
}
```

## å‰ç½®æ¡ä»¶

### 1. ç¯å¢ƒå˜é‡é…ç½®

ç¡®ä¿ `.env.local` æ–‡ä»¶ä¸­é…ç½®äº†ä»¥ä¸‹å˜é‡:

```env
# TikHub API é…ç½®
TIKHUB_API_BASE_URL=https://api.tikhub.io
TIKHUB_API_KEY=your_tikhub_api_key_here
```

### 2. è·å– API Key

1. è®¿é—® [TikHub ç”¨æˆ·ä¸­å¿ƒ](https://user.tikhub.io)
2. æ³¨å†Œå¹¶ç™»å½•è´¦æˆ·
3. åœ¨ç”¨æˆ·ä¸­å¿ƒåˆ›å»º API Token
4. å¤åˆ¶ API Key å¹¶é…ç½®åˆ° `.env.local` æ–‡ä»¶

### 3. ç¡®è®¤ä¾èµ–å®‰è£…

```bash
pnpm install
```

## è¾“å‡ºç¤ºä¾‹

### å…¨éƒ¨å‚ç±»çƒ­é—¨è´¦å·

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘     TikHub API - çƒ­é—¨è´¦å·æµ‹è¯•å·¥å…·                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

=== æµ‹è¯•è·å–çƒ­é—¨è´¦å·åˆ—è¡¨ï¼ˆå…¨éƒ¨å‚ç±»ï¼‰===

æŸ¥è¯¢å‚æ•°:
  æ—¶é—´çª—å£: 24 å°æ—¶
  æ¯é¡µæ•°é‡: 10
  å‚ç±»ç­›é€‰: å…¨éƒ¨

æ­£åœ¨è·å–çƒ­é—¨è´¦å·...

âœ… æˆåŠŸè·å–çƒ­é—¨è´¦å·
æœ¬é¡µæ•°é‡: 10
æœ‰æ›´å¤šæ•°æ®: æ˜¯

=== çƒ­é—¨è´¦å·åˆ—è¡¨ ===

1. äººæ°‘æ—¥æŠ¥
   ç²‰ä¸æ•°: 19.6åƒä¸‡
   è·èµæ•°: 165.9äº¿
   ä½œå“æ•°: 11415
   UID: MS4wLjABAAAA8U_l6rBzmy7bcy6xOJel4v0RzoR_wfAubGPeJimN__4

2. å¤®è§†æ–°é—»
   ç²‰ä¸æ•°: 18.0åƒä¸‡
   è·èµæ•°: 117.2äº¿
   ä½œå“æ•°: 14439
   UID: MS4wLjABAAAAgq8cb7cn9ByhZbmx-XQDdRTvFzmJeBBXOUO4QflP96M

ğŸ“„ å®Œæ•´æ•°æ®å·²ä¿å­˜åˆ°: ./hot-accounts-output.json
```

### ç‰¹å®šå‚ç±»çƒ­é—¨è´¦å·

```
=== æµ‹è¯•è·å–çƒ­é—¨è´¦å·åˆ—è¡¨ï¼ˆç¾é£Ÿå‚ç±»ï¼‰===

æŸ¥è¯¢å‚æ•°:
  æ—¶é—´çª—å£: 24 å°æ—¶
  æ¯é¡µæ•°é‡: 5
  å‚ç±»ç­›é€‰: ç¾é£Ÿ (ID: 628)

æ­£åœ¨è·å–çƒ­é—¨è´¦å·...

âœ… æˆåŠŸè·å–çƒ­é—¨è´¦å·
æœ¬é¡µæ•°é‡: 5
æœ‰æ›´å¤šæ•°æ®: æ˜¯

=== ç¾é£Ÿå‚ç±» - çƒ­é—¨è´¦å·åˆ—è¡¨ ===

1. è·³æŠ•å“¥ è‘±æ²¹é¥¼
   ç²‰ä¸æ•°: 331.3ä¸‡
   è·èµæ•°: 3527.4ä¸‡
   ä½œå“æ•°: 1472

2. è¾¾å“¥åœ¨ä¸Šæµ·
   ç²‰ä¸æ•°: 528.3ä¸‡
   è·èµæ•°: 7542.1ä¸‡
   ä½œå“æ•°: 653

ğŸ“„ å®Œæ•´æ•°æ®å·²ä¿å­˜åˆ°: ./hot-accounts-628-output.json
```

## è¾“å‡ºæ–‡ä»¶

æµ‹è¯•å·¥å…·ä¼šè‡ªåŠ¨ç”ŸæˆJSONæ–‡ä»¶,åŒ…å«:

### å…¨éƒ¨å‚ç±»
`hot-accounts-output.json`:
```json
{
  "queryParams": {
    "dateWindow": 24,
    "pageSize": 10,
    "category": "å…¨éƒ¨"
  },
  "total": null,
  "count": 10,
  "hasMore": true,
  "data": {
    "code": 0,
    "data": {
      "user_list": [...]
    }
  }
}
```

### ç‰¹å®šå‚ç±»
`hot-accounts-{tagId}-output.json`:
```json
{
  "queryParams": {
    "dateWindow": 24,
    "pageSize": 5,
    "category": "ç¾é£Ÿ",
    "tagId": 628
  },
  "total": null,
  "count": 5,
  "hasMore": true,
  "data": {
    "code": 0,
    "data": {
      "user_list": [...]
    }
  }
}
```

## å¸¸è§å‚ç±»æ ‡ç­¾ID

| å‚ç±» | ID | å­å‚ç±»ç¤ºä¾‹ |
|------|----|----|
| ç¾é£Ÿ | 628 | å“é…’æ•™å­¦(62808), ç¾é£Ÿæ•™ç¨‹(62804) |
| æ—…è¡Œ | 629 | æ—…è¡Œé£æ™¯(62905), æ—…è¡Œè®°å½•(62913) |
| ä¼‘é—²å¨±ä¹ | 634 | é€›è¡—, ç°åœºæ¼”å‡º, è¿åŠ¨ç©ä¹ |
| æ–‡åŒ– | 624 | ä¼ ç»Ÿæ–‡åŒ–, æ­¦æœ¯, äººæ–‡ |
| èˆè¹ˆ | 612 | èŠ­è•¾èˆ, æ‰‹åŠ¿èˆ, èˆè¹ˆæ•™å­¦ |
| æ•™è‚²æ ¡å›­ | 626 | é«˜è€ƒ, å‡ºå›½ç•™å­¦, è‰ºè€ƒ |
| æ±½è½¦ | 635 | è½¦è¾†ç±»å‹, ç”¨è½¦, æ–°è½¦ |

è·å–å®Œæ•´æ ‡ç­¾åˆ—è¡¨:
```bash
npx tsx scripts/test-content-tags.ts
```

## åº”ç”¨åœºæ™¯

### 1. ç«å“åˆ†æ
- å‘ç°åŒå‚ç±»çš„å¤´éƒ¨è´¦å·
- åˆ†æç«äº‰å¯¹æ‰‹çš„å†…å®¹ç­–ç•¥
- ç ”ç©¶ç²‰ä¸å¢é•¿è¶‹åŠ¿

### 2. å¯¹æ ‡è´¦å·é€‰æ‹©
- åŸºäºç²‰ä¸æ•°é€‰æ‹©å¯¹æ ‡è´¦å·
- åˆ†æä¸åŒé‡çº§è´¦å·çš„ç‰¹ç‚¹
- åˆ¶å®šè´¦å·æˆé•¿è·¯å¾„

### 3. å¸‚åœºè¶‹åŠ¿ç ”ç©¶
- ä¸åŒæ—¶é—´çª—å£çš„çƒ­é—¨è´¦å·å˜åŒ–
- æ–°å…´è´¦å·çš„å‘ç°å’Œè·Ÿè¸ª
- å‚ç±»çƒ­åº¦å’Œè¶‹åŠ¿åˆ†æ

### 4. å†…å®¹ç­–ç•¥ä¼˜åŒ–
- ç ”ç©¶çƒ­é—¨è´¦å·çš„å†…å®¹ç‰¹ç‚¹
- åˆ†æä½œå“æ•°é‡ä¸ç²‰ä¸å¢é•¿çš„å…³ç³»
- ä¼˜åŒ–å†…å®¹å‘å¸ƒç­–ç•¥

## API è´¹ç”¨

æ ¹æ® TikHub API å®šä»·:
- æ¯æ¬¡è¯·æ±‚: $0.001 USD
- ä»…åœ¨è¿”å›çŠ¶æ€ç  200 æ—¶è®¡è´¹
- ä¸ç¼“å­˜ï¼Œå®æ—¶è·å–æœ€æ–°æ•°æ®

## æ•…éšœæ’æŸ¥

### 1. è¿æ¥å¤±è´¥

**é”™è¯¯**: `TikHub APIè¿æ¥å¤±è´¥`

**è§£å†³æ–¹æ³•**:
- æ£€æŸ¥ `TIKHUB_API_KEY` æ˜¯å¦æ­£ç¡®é…ç½®
- ç¡®è®¤ API Key æ˜¯å¦æœ‰æ•ˆ
- æ£€æŸ¥ç½‘ç»œè¿æ¥

### 2. 401 è®¤è¯é”™è¯¯

**é”™è¯¯**: `é”™è¯¯ç : 401`

**è§£å†³æ–¹æ³•**:
- API Key æ— æ•ˆæˆ–å·²è¿‡æœŸ
- é‡æ–°ç”Ÿæˆ API Key å¹¶æ›´æ–° `.env.local`

### 3. å“åº”æ•°æ®æ ¼å¼é”™è¯¯

**é”™è¯¯**: `å“åº”æ•°æ®æ ¼å¼é”™è¯¯`

**è§£å†³æ–¹æ³•**:
- æ£€æŸ¥ API ç«¯ç‚¹æ˜¯å¦æ­£ç¡®
- æŸ¥çœ‹å®Œæ•´å“åº”å†…å®¹ï¼ˆä¼šåœ¨é”™è¯¯æ—¶è¾“å‡ºï¼‰
- æ›´æ–°ç±»å‹å®šä¹‰ä»¥åŒ¹é…å®é™… API å“åº”

### 4. ç©ºæ•°æ®åˆ—è¡¨

**é—®é¢˜**: `æœ¬é¡µæ•°é‡: 0`

**å¯èƒ½åŸå› **:
- å‚ç±»IDä¸æ­£ç¡®
- è¯¥å‚ç±»æš‚æ—¶æ²¡æœ‰çƒ­é—¨è´¦å·
- æ—¶é—´çª—å£å¤ªçŸ­ï¼Œæ²¡æœ‰æ•°æ®

**è§£å†³æ–¹æ³•**:
- ä½¿ç”¨ `test-content-tags.ts` ç¡®è®¤æ­£ç¡®çš„å‚ç±»ID
- å¢åŠ æ—¶é—´çª—å£ï¼ˆå¦‚ä½¿ç”¨ `--hours=48`ï¼‰
- å°è¯•æŸ¥è¯¢å…¨éƒ¨å‚ç±»ï¼ˆä¸ä½¿ç”¨ `--tag` å‚æ•°ï¼‰

## æŠ€æœ¯å®ç°

### æ ¸å¿ƒåŠŸèƒ½

1. **POSTè¯·æ±‚æ”¯æŒ** - TikHubçƒ­é—¨è´¦å·æ¥å£ä½¿ç”¨POSTæ–¹æ³•ï¼Œè€ŒéGET
2. **å‚ç±»æ ‡ç­¾é›†æˆ** - è‡ªåŠ¨ä»å‚ç±»æ ‡ç­¾æ¥å£è·å–æ ‡ç­¾åç§°
3. **æ•°å­—æ ¼å¼åŒ–** - ç²‰ä¸æ•°å’Œè·èµæ•°ä½¿ç”¨ä¸‡/åƒä¸‡/äº¿å•ä½
4. **å‘½ä»¤è¡Œå‚æ•°** - çµæ´»çš„å‚æ•°é…ç½®

### è®¾è®¡ç‰¹ç‚¹

- âœ… ç±»å‹å®‰å…¨ - å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
- âœ… é”™è¯¯å¤„ç† - å®Œå–„çš„é”™è¯¯æ•è·å’Œæç¤º
- âœ… æ•°æ®æ ¼å¼åŒ– - ç¾è§‚çš„æ•°å­—æ˜¾ç¤º
- âœ… æ•°æ®å¯¼å‡º - è‡ªåŠ¨ä¿å­˜ JSON æ ¼å¼æ•°æ®
- âœ… å‘½ä»¤è¡Œå‹å¥½ - æ”¯æŒå‚æ•°é…ç½®

## ç›¸å…³æ–‡ä»¶

- **æµ‹è¯•è„šæœ¬**: `scripts/test-hot-accounts.ts`
- **ç±»å‹å®šä¹‰**: `lib/tikhub/types.ts` (HotAccountInfo, GetHotAccountListParams, DouyinHotAccountListResponse)
- **å®¢æˆ·ç«¯æ–¹æ³•**: `lib/tikhub/client.ts` (getHotAccountList)

## åœ¨ä»£ç ä¸­ä½¿ç”¨

```typescript
import { getTikHubClient } from '@/lib/tikhub'
import type { HotAccountQueryTag } from '@/lib/tikhub/types'

async function getHotAccountsExample() {
  const client = getTikHubClient()

  // è·å–å…¨éƒ¨å‚ç±»çƒ­é—¨è´¦å·
  const allHotAccounts = await client.getHotAccountList({
    page_num: 1,
    page_size: 20
  })

  console.log(`è·å–åˆ° ${allHotAccounts.data.user_list.length} ä¸ªçƒ­é—¨è´¦å·`)

  // è·å–ç¾é£Ÿå‚ç±»çƒ­é—¨è´¦å·
  const foodHotAccounts = await client.getHotAccountList({
    page_num: 1,
    page_size: 10,
    query_tag: { value: 628 }
  })

  // å¤„ç†è´¦å·æ•°æ®
  foodHotAccounts.data.user_list.forEach(account => {
    console.log(`${account.nick_name}: ${account.fans_cnt} ç²‰ä¸`)
  })
}
```

### æ„å»ºæŸ¥è¯¢å‚æ•°

```typescript
import type { HotAccountQueryTag } from '@/lib/tikhub/types'

// å•ä¸ªå‚ç±»
const queryTag1: HotAccountQueryTag = { value: 628 }

// å‚ç±» + å­å‚ç±»
const queryTag2: HotAccountQueryTag = {
  value: 628,
  children: [
    { value: 62808 }, // å“é…’æ•™å­¦
    { value: 62804 }  // ç¾é£Ÿæ•™ç¨‹
  ]
}

// å…¨éƒ¨å‚ç±»ï¼ˆç©ºå¯¹è±¡ï¼‰
const queryTagAll = {}
```

## è®¸å¯è¯

æœ¬é¡¹ç›®éµå¾ªé¡¹ç›®ä¸»ä»“åº“çš„è®¸å¯è¯ã€‚
