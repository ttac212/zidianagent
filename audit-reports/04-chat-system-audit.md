# èŠå¤©ç³»ç»Ÿæ¨¡å—å®¡è®¡æŠ¥å‘Š

## æ¨¡å—æ¦‚è§ˆ

èŠå¤©ç³»ç»Ÿæ˜¯é¡¹ç›®çš„æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ï¼Œå®ç°äº†å®Œæ•´çš„AIå¯¹è¯ä½“éªŒï¼ŒåŒ…æ‹¬å¤šæ¨¡å‹æ”¯æŒã€æµå¼å“åº”ã€å¯¹è¯ç®¡ç†ã€çŠ¶æ€ç®¡ç†ç­‰åŠŸèƒ½ã€‚é‡‡ç”¨React Hooksæ¶æ„ï¼Œæ”¯æŒå®æ—¶æµå¼å“åº”å’Œå¤æ‚çš„çŠ¶æ€ç®¡ç†ã€‚

### æ ¸å¿ƒç»„ä»¶æ¶æ„
```
èŠå¤©ç³»ç»Ÿ
â”œâ”€â”€ ä¸»å®¹å™¨ç»„ä»¶
â”‚   â””â”€â”€ SmartChatCenterV2 (smart-chat-center-v2-fixed.tsx)
â”œâ”€â”€ å­ç»„ä»¶
â”‚   â”œâ”€â”€ ChatHeader - èŠå¤©å¤´éƒ¨
â”‚   â”œâ”€â”€ ChatMessages - æ¶ˆæ¯åˆ—è¡¨
â”‚   â”œâ”€â”€ ChatInput - è¾“å…¥æ¡†
â”‚   â”œâ”€â”€ MessageItem - å•æ¡æ¶ˆæ¯
â”‚   â””â”€â”€ ModelSelector - æ¨¡å‹é€‰æ‹©å™¨
â”œâ”€â”€ çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ useChatState - èŠå¤©çŠ¶æ€
â”‚   â”œâ”€â”€ useChatActions - èŠå¤©æ“ä½œ
â”‚   â”œâ”€â”€ useConversations - å¯¹è¯ç®¡ç†
â”‚   â””â”€â”€ useModelState - æ¨¡å‹çŠ¶æ€
â”œâ”€â”€ APIé›†æˆ
â”‚   â””â”€â”€ /api/chat - èŠå¤©APIç«¯ç‚¹
â””â”€â”€ ç±»å‹å®šä¹‰
    â””â”€â”€ types/chat.ts - ç±»å‹ç³»ç»Ÿ
```

## åŠŸèƒ½ç‰¹æ€§å®¡è®¡

### âœ… æ ¸å¿ƒåŠŸèƒ½

#### 1. å¤šæ¨¡å‹æ”¯æŒ
- **æ¨¡å‹ç™½åå•**: ç¯å¢ƒå˜é‡é…ç½®çš„æ¨¡å‹åˆ—è¡¨
- **åŠ¨æ€åˆ‡æ¢**: æ”¯æŒå¯¹è¯ä¸­åˆ‡æ¢æ¨¡å‹
- **æ¨¡å‹éªŒè¯**: ä¸¥æ ¼çš„æ¨¡å‹IDéªŒè¯æœºåˆ¶
- **å‹å¥½åç§°**: æ¨¡å‹IDåˆ°æ˜¾ç¤ºåç§°çš„æ˜ å°„

#### 2. æµå¼å“åº”
- **SSEæ”¯æŒ**: Server-Sent Eventså®æ—¶æµå¼å“åº”
- **æ¸è¿›æ˜¾ç¤º**: æ¶ˆæ¯å†…å®¹é€å­—æ˜¾ç¤º
- **ä¸­æ–­æ§åˆ¶**: æ”¯æŒå–æ¶ˆæ­£åœ¨è¿›è¡Œçš„è¯·æ±‚
- **é”™è¯¯æ¢å¤**: æµå¼å“åº”ä¸­æ–­åçš„é”™è¯¯å¤„ç†

#### 3. å¯¹è¯ç®¡ç†
- **æŒä¹…åŒ–**: å¯¹è¯æ•°æ®å­˜å‚¨åˆ°æ•°æ®åº“
- **æœ¬åœ°ç¼“å­˜**: localStorageç¼“å­˜å¯¹è¯åˆ—è¡¨
- **è‡ªåŠ¨æ ‡é¢˜**: æ™ºèƒ½ç”Ÿæˆå¯¹è¯æ ‡é¢˜
- **å†å²è®°å½•**: å®Œæ•´çš„æ¶ˆæ¯å†å²ç®¡ç†

#### 4. çŠ¶æ€ç®¡ç†
- **useReducer**: å¤æ‚çŠ¶æ€çš„é›†ä¸­ç®¡ç†
- **æ€§èƒ½ä¼˜åŒ–**: useMemoå’ŒuseCallbackä¼˜åŒ–
- **çŠ¶æ€åŒæ­¥**: å¤šç»„ä»¶é—´çŠ¶æ€ä¸€è‡´æ€§
- **é”™è¯¯çŠ¶æ€**: å®Œå–„çš„é”™è¯¯çŠ¶æ€ç®¡ç†

## å®‰å…¨æ€§å®¡è®¡

### âœ… ä¼˜åŠ¿

#### 1. è®¤è¯ä¿æŠ¤
- **JWTéªŒè¯**: æ‰€æœ‰èŠå¤©è¯·æ±‚éœ€è¦æœ‰æ•ˆJWT token
- **ç”¨æˆ·éš”ç¦»**: ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„å¯¹è¯
- **é…é¢æ§åˆ¶**: æœˆåº¦tokenä½¿ç”¨é‡é™åˆ¶
- **æƒé™æ£€æŸ¥**: ä¸¥æ ¼çš„ç”¨æˆ·æƒé™éªŒè¯

#### 2. è¾“å…¥éªŒè¯
- **å†…å®¹è¿‡æ»¤**: ç”¨æˆ·è¾“å…¥å†…å®¹éªŒè¯
- **æ¨¡å‹éªŒè¯**: ä¸¥æ ¼çš„æ¨¡å‹IDç™½åå•éªŒè¯
- **å‚æ•°éªŒè¯**: æ¸©åº¦ç­‰å‚æ•°çš„èŒƒå›´éªŒè¯
- **é•¿åº¦é™åˆ¶**: æ¶ˆæ¯å†…å®¹é•¿åº¦é™åˆ¶

#### 3. é”™è¯¯å¤„ç†
- **å®‰å…¨é”™è¯¯**: ä¸æš´éœ²æ•æ„Ÿç³»ç»Ÿä¿¡æ¯
- **ç”¨æˆ·å‹å¥½**: æ¸…æ™°çš„é”™è¯¯æç¤ºä¿¡æ¯
- **æ—¥å¿—è®°å½•**: é”™è¯¯äº‹ä»¶çš„è®°å½•å’Œç›‘æ§
- **é™çº§å¤„ç†**: æœåŠ¡å¼‚å¸¸æ—¶çš„é™çº§ç­–ç•¥

### âš ï¸ å®‰å…¨é£é™©

#### 1. ä¸­ç­‰é£é™©é—®é¢˜

**1.1 ç¼–è¾‘å™¨ä¸Šä¸‹æ–‡æ³¨å…¥**
```typescript
// app/api/chat/route.ts:126-133
const sysMessages = editorExcerpt
  ? [{
      role: "system",
      content: `ä»¥ä¸‹ä¸ºç”¨æˆ·å½“å‰ç¼–è¾‘å™¨ä¸­çš„ä¸Šä¸‹æ–‡ç‰‡æ®µï¼š\n\n${editorExcerpt}`,
    }]
  : []
```
- **é£é™©**: ç”¨æˆ·å¯ä»¥é€šè¿‡editorExcerptæ³¨å…¥ä»»æ„ç³»ç»Ÿæ¶ˆæ¯
- **å½±å“**: å¯èƒ½å½±å“AIæ¨¡å‹çš„è¡Œä¸ºå’Œå“åº”
- **å»ºè®®**: å¯¹editorExcerptè¿›è¡Œä¸¥æ ¼çš„å†…å®¹è¿‡æ»¤å’Œé•¿åº¦é™åˆ¶

**1.2 æ¨¡å‹åˆ‡æ¢å®‰å…¨**
```typescript
// hooks/use-chat-actions-fixed.ts:59-61
if (modelFromHook && modelFromState && modelFromHook !== modelFromState) {
  console.warn('Model inconsistency detected:', { modelFromHook, modelFromState })
}
```
- **é£é™©**: æ¨¡å‹çŠ¶æ€ä¸ä¸€è‡´å¯èƒ½å¯¼è‡´ä½¿ç”¨æœªæˆæƒæ¨¡å‹
- **å½±å“**: ç»•è¿‡æ¨¡å‹ç™½åå•é™åˆ¶
- **å»ºè®®**: æ¨¡å‹ä¸ä¸€è‡´æ—¶åº”è¯¥é˜»æ­¢è¯·æ±‚è€Œä¸æ˜¯ä»…è­¦å‘Š

#### 2. ä½é£é™©é—®é¢˜

**2.1 å®¢æˆ·ç«¯çŠ¶æ€æš´éœ²**
```typescript
// å¤šä¸ªç»„ä»¶ä¸­æš´éœ²å†…éƒ¨çŠ¶æ€åˆ°æ§åˆ¶å°
console.warn('Model inconsistency detected:', { modelFromHook, modelFromState })
```
- **é£é™©**: å¼€å‘è°ƒè¯•ä¿¡æ¯å¯èƒ½åœ¨ç”Ÿäº§ç¯å¢ƒæš´éœ²
- **å½±å“**: ä¿¡æ¯æ³„éœ²é£é™©
- **å»ºè®®**: ç”Ÿäº§ç¯å¢ƒç§»é™¤è°ƒè¯•æ—¥å¿—

## ä»£ç è´¨é‡å®¡è®¡

### âœ… ä¼˜åŠ¿

#### 1. æ¶æ„è®¾è®¡
- **æ¨¡å—åŒ–**: æ¸…æ™°çš„ç»„ä»¶å’ŒHookåˆ†ç¦»
- **å¯å¤ç”¨**: é«˜åº¦å¯å¤ç”¨çš„ç»„ä»¶è®¾è®¡
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰
- **æ€§èƒ½ä¼˜åŒ–**: åˆç†ä½¿ç”¨Reactä¼˜åŒ–æŠ€æœ¯

#### 2. çŠ¶æ€ç®¡ç†
- **é›†ä¸­ç®¡ç†**: useReduceré›†ä¸­ç®¡ç†å¤æ‚çŠ¶æ€
- **ä¸å¯å˜æ€§**: æ­£ç¡®çš„ä¸å¯å˜çŠ¶æ€æ›´æ–°
- **æ€§èƒ½ä¼˜åŒ–**: é˜²æŠ–ã€ç¼“å­˜ç­‰æ€§èƒ½ä¼˜åŒ–
- **é”™è¯¯è¾¹ç•Œ**: å®Œå–„çš„é”™è¯¯çŠ¶æ€å¤„ç†

#### 3. ç”¨æˆ·ä½“éªŒ
- **å®æ—¶åé¦ˆ**: æµå¼å“åº”æä¾›å®æ—¶ä½“éªŒ
- **åŠ è½½çŠ¶æ€**: æ¸…æ™°çš„åŠ è½½å’Œé”™è¯¯çŠ¶æ€
- **äº¤äº’ä¼˜åŒ–**: æµç•…çš„ç”¨æˆ·äº¤äº’ä½“éªŒ
- **å“åº”å¼**: è‰¯å¥½çš„ç§»åŠ¨ç«¯é€‚é…

### âš ï¸ æ”¹è¿›å»ºè®®

#### 1. é”™è¯¯å¤„ç†å¢å¼º
```typescript
// å½“å‰: ç®€å•çš„é”™è¯¯çŠ¶æ€
dispatch({ type: 'SET_ERROR', payload: 'å‘é€å¤±è´¥' })

// å»ºè®®: ç»“æ„åŒ–é”™è¯¯å¤„ç†
dispatch({ 
  type: 'SET_ERROR', 
  payload: {
    type: 'NETWORK_ERROR',
    message: 'ç½‘ç»œè¿æ¥å¤±è´¥',
    retryable: true,
    timestamp: Date.now()
  }
})
```

#### 2. æ€§èƒ½ä¼˜åŒ–
```typescript
// å»ºè®®: è™šæ‹ŸåŒ–é•¿æ¶ˆæ¯åˆ—è¡¨
import { FixedSizeList as List } from 'react-window'

// å»ºè®®: æ¶ˆæ¯å†…å®¹æ‡’åŠ è½½
const MessageContent = React.lazy(() => import('./MessageContent'))
```

#### 3. å†…å­˜ç®¡ç†
```typescript
// å»ºè®®: æ¸…ç†é•¿æœŸæœªä½¿ç”¨çš„å¯¹è¯
useEffect(() => {
  const cleanup = setInterval(() => {
    cleanupOldConversations()
  }, 5 * 60 * 1000) // 5åˆ†é’Ÿæ¸…ç†ä¸€æ¬¡
  
  return () => clearInterval(cleanup)
}, [])
```

## æ¶æ„ä¸€è‡´æ€§å®¡è®¡

### âœ… ç¬¦åˆæ ‡å‡†

1. **ç»„ä»¶è®¾è®¡**: éµå¾ªReactæœ€ä½³å®è·µ
2. **Hookæ¨¡å¼**: æ­£ç¡®ä½¿ç”¨è‡ªå®šä¹‰Hook
3. **ç±»å‹å®šä¹‰**: å®Œæ•´çš„TypeScriptç±»å‹ç³»ç»Ÿ
4. **çŠ¶æ€ç®¡ç†**: ä¸€è‡´çš„çŠ¶æ€ç®¡ç†æ¨¡å¼

### âš ï¸ ä¸ä¸€è‡´é—®é¢˜

#### 1. æ¶ˆæ¯æ ¼å¼ä¸ç»Ÿä¸€
```typescript
// APIå“åº”æ ¼å¼
role: 'USER' | 'ASSISTANT' | 'SYSTEM' | 'FUNCTION'

// å‰ç«¯ä½¿ç”¨æ ¼å¼  
role: 'user' | 'assistant'

// å»ºè®®: ç»Ÿä¸€æ¶ˆæ¯æ ¼å¼æˆ–æ·»åŠ è½¬æ¢å±‚
```

#### 2. é”™è¯¯å¤„ç†ä¸ä¸€è‡´
```typescript
// æœ‰äº›åœ°æ–¹ä½¿ç”¨å­—ç¬¦ä¸²é”™è¯¯
error: string

// æœ‰äº›åœ°æ–¹ä½¿ç”¨é”™è¯¯å¯¹è±¡
error: { message: string, code: string }

// å»ºè®®: ç»Ÿä¸€é”™è¯¯ç±»å‹å®šä¹‰
```

## æ€§èƒ½å®¡è®¡

### âœ… ä¼˜åŠ¿

1. **Reactä¼˜åŒ–**: æ­£ç¡®ä½¿ç”¨useMemoã€useCallback
2. **è™šæ‹Ÿæ»šåŠ¨**: é•¿æ¶ˆæ¯åˆ—è¡¨çš„è™šæ‹ŸåŒ–
3. **æ‡’åŠ è½½**: ç»„ä»¶å’Œæ•°æ®çš„æ‡’åŠ è½½
4. **ç¼“å­˜ç­–ç•¥**: å¯¹è¯åˆ—è¡¨çš„æœ¬åœ°ç¼“å­˜

### âš ï¸ æ€§èƒ½é—®é¢˜

#### 1. å†…å­˜æ³„æ¼é£é™©
```typescript
// é•¿æ—¶é—´è¿è¡Œå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼
const [conversations, setConversations] = useState<Conversation[]>([])

// å»ºè®®: é™åˆ¶å†…å­˜ä¸­çš„å¯¹è¯æ•°é‡
const MAX_CONVERSATIONS_IN_MEMORY = 50
```

#### 2. é‡å¤æ¸²æŸ“
```typescript
// æŸäº›ç»„ä»¶å¯èƒ½å­˜åœ¨ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
// å»ºè®®: ä½¿ç”¨React.memoä¼˜åŒ–
export const MessageItem = React.memo(({ message, onCopy, onRetry }) => {
  // ç»„ä»¶å®ç°
})
```

## å…³é”®æ–‡ä»¶è¯„ä¼°

### ğŸŸ¢ é«˜è´¨é‡æ–‡ä»¶
- `hooks/use-chat-state.ts` - çŠ¶æ€ç®¡ç†è®¾è®¡è‰¯å¥½
- `components/chat/message-item.tsx` - ç»„ä»¶è®¾è®¡ä¼˜ç§€
- `types/chat.ts` - ç±»å‹å®šä¹‰å®Œæ•´

### ğŸŸ¡ éœ€è¦æ”¹è¿›æ–‡ä»¶
- `app/api/chat/route.ts` - éœ€è¦åŠ å¼ºå®‰å…¨éªŒè¯
- `hooks/use-chat-actions-fixed.ts` - é”™è¯¯å¤„ç†éœ€è¦å¢å¼º
- `hooks/use-conversations.ts` - æ€§èƒ½ä¼˜åŒ–ç©ºé—´

### ğŸ”´ é£é™©æ–‡ä»¶
- æ— é«˜é£é™©æ–‡ä»¶ï¼Œæ•´ä½“è´¨é‡è¾ƒå¥½

## ä¼˜å…ˆçº§æ”¹è¿›å»ºè®®

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ (è¿‘æœŸä¿®å¤)
1. **å¢å¼ºè¾“å…¥éªŒè¯**: å¯¹editorExcerptç­‰ç”¨æˆ·è¾“å…¥è¿›è¡Œä¸¥æ ¼éªŒè¯
2. **æ¨¡å‹çŠ¶æ€ä¸€è‡´æ€§**: æ¨¡å‹ä¸ä¸€è‡´æ—¶é˜»æ­¢è¯·æ±‚
3. **é”™è¯¯å¤„ç†æ ‡å‡†åŒ–**: ç»Ÿä¸€é”™è¯¯ç±»å‹å’Œå¤„ç†æ–¹å¼

### ğŸŸ¢ ä½ä¼˜å…ˆçº§ (é•¿æœŸä¼˜åŒ–)
1. **æ€§èƒ½ä¼˜åŒ–**: è™šæ‹ŸåŒ–ã€æ‡’åŠ è½½ç­‰æ€§èƒ½ä¼˜åŒ–
2. **å†…å­˜ç®¡ç†**: é™åˆ¶å†…å­˜ä½¿ç”¨å’Œæ¸…ç†æœºåˆ¶
3. **ç”¨æˆ·ä½“éªŒ**: æ›´ä¸°å¯Œçš„äº¤äº’åé¦ˆå’ŒåŠ¨ç”»

## ğŸ”¬ æ·±åº¦æŠ€æœ¯åˆ†æ

### çŠ¶æ€ç®¡ç†æ¶æ„ â­â­â­â­â­

#### âœ… ä¼˜ç§€è®¾è®¡ç‰¹ç‚¹
```typescript
// use-chat-state.ts: åŸºäºuseReducerçš„å¤æ‚çŠ¶æ€ç®¡ç†
function chatReducer(state: ChatState, action: ChatAction): ChatState {
  switch (action.type) {
    case 'ADD_MESSAGE':
      return { 
        ...state, 
        messages: [...state.messages, action.payload],
        error: null // æ™ºèƒ½é”™è¯¯æ¸…ç†
      }
    case 'UPDATE_MESSAGE':
      return {
        ...state,
        messages: state.messages.map(msg => 
          msg.id === action.payload.id 
            ? { ...msg, ...action.payload.updates }
            : msg
        )
      }
  }
}
```

**æŠ€æœ¯äº®ç‚¹**:
- **ä¸å¯å˜æ›´æ–°**: ä¸¥æ ¼éµå¾ªä¸å¯å˜çŠ¶æ€æ›´æ–°åŸåˆ™
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„TypeScriptç±»å‹ç³»ç»Ÿè¦†ç›–
- **æ€§èƒ½é€‰æ‹©å™¨**: æä¾›`messageSelectors`ç­‰ä¼˜åŒ–æŸ¥è¯¢
- **çŠ¶æ€æ¸…ç†**: æ™ºèƒ½çš„é”™è¯¯çŠ¶æ€æ¸…ç†æœºåˆ¶

#### ğŸš€ å…ˆè¿›çš„ä¼˜åŒ–ç­–ç•¥
```typescript
// é˜²æŠ–å’ŒèŠ‚æµä¼˜åŒ–
export const optimizedActions = {
  debouncedSetInput: (dispatch, delay = 300) => {
    let timeoutId: NodeJS.Timeout
    return (input: string) => {
      clearTimeout(timeoutId)
      timeoutId = setTimeout(() => {
        dispatch({ type: 'SET_INPUT', payload: input })
      }, delay)
    }
  }
}
```

### æµå¼å“åº”å¤„ç† â­â­â­â­â­

#### âœ… ä¼ä¸šçº§å®ç°
```typescript
// use-chat-actions-fixed.ts: å®Œæ•´çš„SSEæµå¤„ç†
while (true) {
  const { done, value } = await reader.read()
  if (done) break

  const chunk = new TextDecoder().decode(value)
  const lines = chunk.split('\n')
  
  for (const line of lines) {
    if (line.startsWith('data: ') && line !== 'data: [DONE]') {
      try {
        const data = JSON.parse(line.slice(6))
        const content = data.choices?.[0]?.delta?.content
        if (content) {
          assistantContent += content
          dispatch({
            type: 'UPDATE_MESSAGE',
            payload: { id: assistantMessage.id, updates: { content: assistantContent } }
          })
        }
      } catch (parseError) {
        parseErrorCount++
        if (parseErrorCount > maxParseErrors) break // é”™è¯¯å®¹é™æœºåˆ¶
      }
    }
  }
}
```

**æŠ€æœ¯ä¼˜åŠ¿**:
- **é”™è¯¯å®¹é™**: æœ€å¤šå®¹å¿5æ¬¡è§£æé”™è¯¯
- **å®æ—¶æ›´æ–°**: å¢é‡æ›´æ–°æ¶ˆæ¯å†…å®¹
- **ä¸­æ–­æ”¯æŒ**: AbortControllerä¼˜é›…ä¸­æ–­
- **é‡è¯•æœºåˆ¶**: é›†æˆ`fetchWithRetry`è‡ªåŠ¨é‡è¯•

### æ¨¡å‹ä¸€è‡´æ€§ç³»ç»Ÿ â­â­â­â­â­

#### âœ… å…ˆè¿›çš„ä¸€è‡´æ€§ä¿éšœ
```typescript
// å¤šå±‚æ¨¡å‹çŠ¶æ€ç®¡ç†
const getSendingModel = useCallback((): string => {
  const modelFromHook = getCurrentModel ? getCurrentModel() : null
  const modelFromState = state.settings.modelId
  
  const actualModel = modelFromHook || modelFromState
  
  // ä¸€è‡´æ€§æ£€æŸ¥å’Œè­¦å‘Š
  if (modelFromHook && modelFromState && modelFromHook !== modelFromState) {
    console.warn('Model inconsistency detected:', { modelFromHook, modelFromState })
  }
  
  return actualModel
}, [getCurrentModel, state.settings.modelId])
```

**å®‰å…¨æœºåˆ¶**:
- **å¤šæºéªŒè¯**: åŒæ—¶éªŒè¯HookçŠ¶æ€å’Œç»„ä»¶çŠ¶æ€
- **ä¸€è‡´æ€§æ£€æŸ¥**: å‘ç°ä¸ä¸€è‡´æ—¶è®°å½•è­¦å‘Š
- **éªŒè¯å™¨é›†æˆ**: ä½¿ç”¨`validateModelId`è¿›è¡Œç™½åå•æ£€æŸ¥

### é”™è¯¯å¤„ç†å’Œç›‘æ§ â­â­â­â­

#### âœ… å®Œå–„çš„ç›‘æ§ç³»ç»Ÿ
```typescript
// APIç›‘æ§é›†æˆ
const requestStartTime = Date.now()
const requestDuration = Date.now() - requestStartTime
apiMonitor.logRequest(
  '/api/chat',
  'POST',
  response.status,
  requestDuration,
  response.ok ? undefined : `HTTP ${response.status}`
)
```

**ç›‘æ§ç‰¹ç‚¹**:
- **æ€§èƒ½è¿½è¸ª**: è®°å½•APIè¯·æ±‚è€—æ—¶
- **é”™è¯¯ç»Ÿè®¡**: è‡ªåŠ¨ç»Ÿè®¡å¤±è´¥ç‡
- **é‡è¯•æœºåˆ¶**: 3æ¬¡é‡è¯•ï¼ŒæŒ‡æ•°é€€é¿ç­–ç•¥

## ğŸ” æ–°å‘ç°çš„æŠ€æœ¯é—®é¢˜

### ğŸŸ¡ å¼‚æ­¥çŠ¶æ€ä¸€è‡´æ€§é£é™©
```typescript
// å‘ç°ï¼šå¯¹è¯è‡ªåŠ¨åˆ›å»ºçš„ç«æ€æ¡ä»¶
if (!currentConversation && onCreateConversation) {
  const newConversation = await onCreateConversation(modelForNewConversation)
  if (!newConversation) {
    dispatch({ type: 'SET_ERROR', payload: 'åˆ›å»ºå¯¹è¯å¤±è´¥' })
    return // ç›´æ¥è¿”å›ï¼Œå¯èƒ½å¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´
  }
}
```
**é£é™©**: å¯¹è¯åˆ›å»ºå¤±è´¥åçŠ¶æ€å¯èƒ½ä¸ä¸€è‡´
**å»ºè®®**: æ·»åŠ çŠ¶æ€å›æ»šæœºåˆ¶

### ğŸŸ¡ å†…å­˜ç®¡ç†ä¼˜åŒ–ç©ºé—´
```typescript
// å‘ç°ï¼šæ¶ˆæ¯å†å²å¯èƒ½æ— é™å¢é•¿
const currentMessages = [...state.messages, userMessage]
```
**é£é™©**: é•¿å¯¹è¯å¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡º
**å»ºè®®**: å®ç°æ¶ˆæ¯å†å²åˆ†é¡µæˆ–è™šæ‹ŸåŒ–

## ğŸ“ˆ æ›´æ–°åè¯„åˆ†

- **å®‰å…¨æ€§**: 8.5/10 (å¢å¼ºçš„æ¨¡å‹éªŒè¯å’Œé”™è¯¯å¤„ç†)
- **ä»£ç è´¨é‡**: 9.5/10 (ä¼ä¸šçº§æ¶æ„ï¼Œä¼˜ç§€çš„æŠ€æœ¯å®ç°)
- **æ¶æ„ä¸€è‡´æ€§**: 9/10 (é«˜åº¦ä¸€è‡´çš„è®¾è®¡æ¨¡å¼)
- **æ€§èƒ½**: 9/10 (å…ˆè¿›çš„ä¼˜åŒ–ç­–ç•¥å’Œæµå¼å¤„ç†)
- **ç”¨æˆ·ä½“éªŒ**: 9.5/10 (æµç•…çš„å®æ—¶ä½“éªŒå’Œé”™è¯¯æ¢å¤)
- **å¯ç»´æŠ¤æ€§**: 9.5/10 (æ¨¡å—åŒ–è®¾è®¡ï¼Œç±»å‹å®‰å…¨ï¼Œæ˜“äºæ‰©å±•)
- **æŠ€æœ¯åˆ›æ–°**: 9.5/10 (å…ˆè¿›çš„çŠ¶æ€ç®¡ç†å’Œæµå¼å¤„ç†æ¶æ„)

---
*æŠ¥å‘Šç”Ÿæˆæ—¶é—´: 2025-01-03*
*å®¡è®¡èŒƒå›´: èŠå¤©ç³»ç»Ÿæ¨¡å—*
